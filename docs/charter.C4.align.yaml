# Charter: [C4] Element å·¥å…·å®Œæ•´å®ç°

task_id: C4
task_name: Element å·¥å…·å®Œæ•´å®ç°ï¼ˆ23ä¸ªå·¥å…· + å­ç±»æ“ä½œï¼‰
stage: C
phase: Align (Retrospective)
created_at: "2025-10-02"
status: COMPLETED
estimated_hours: 6-8
actual_hours: 8

## Goal (ç›®æ ‡)

å®ç° Element çº§åˆ«çš„å®Œæ•´å·¥å…·é›†ï¼ŒåŒ…æ‹¬ 23 ä¸ªæ ¸å¿ƒäº¤äº’å·¥å…·å’Œ 6 ç±»ä¸“ç”¨ç»„ä»¶æ“ä½œï¼Œè¦†ç›–ç‚¹å‡»ã€é•¿æŒ‰ã€è§¦æ‘¸äº‹ä»¶ã€å±æ€§è¯»å–ã€è¾“å…¥ã€æ»‘åŠ¨ã€ç§»åŠ¨ç­‰æ‰€æœ‰å…ƒç´ æ“ä½œã€‚

**æ ¸å¿ƒäº¤ä»˜ç‰©**:
- `src/tools/element.ts` - 23 ä¸ªå·¥å…· + å­ç±»æ“ä½œ (956 lines)
- `tests/unit/element.test.ts` - å•å…ƒæµ‹è¯• (1104 lines, 72 tests)
- å·¥å…·åˆ†ç±»:
  - **äº¤äº’æ“ä½œ** (7ä¸ª): tap, longpress, touchstart, touchmove, touchend, input, trigger
  - **å±æ€§è¯»å–** (6ä¸ª): getText, getAttribute, getValue, getProperty, getStyle, getComputedStyle
  - **ä½ç½®å°ºå¯¸** (3ä¸ª): getSize, getOffset, getBoundingClientRect
  - **ç§»åŠ¨æ»‘åŠ¨** (3ä¸ª): swipe, moveTo, scrollTo
  - **å­ç±»æ“ä½œ** (6ç±»): Input, Textarea, Picker, ScrollView, Swiper, MovableView

## Non-Goals (éç›®æ ‡)

- âŒ ä¸å®ç°æ–­è¨€å·¥å…·ï¼ˆç•™ç»™ Stage Dï¼‰
- âŒ ä¸å®ç°å½•åˆ¶åŠŸèƒ½ï¼ˆç•™ç»™ Stage Fï¼‰
- âŒ ä¸å®ç°å…ƒç´ æˆªå›¾ï¼ˆå±äº Page çº§åˆ«ï¼‰
- âŒ ä¸å®ç°æ‹–æ‹½åˆ°å…¶ä»–å…ƒç´ ï¼ˆç®€åŒ–å®ç°ï¼‰

## Scope (èŒƒå›´)

### In Scope (åŒ…å«)

#### 1. åŸºç¡€äº¤äº’ (7ä¸ªå·¥å…·)

- âœ… **tap**: ç‚¹å‡»å…ƒç´ 
- âœ… **longpress**: é•¿æŒ‰å…ƒç´ ï¼ˆ350msï¼‰
- âœ… **touchstart**: è§¦æ‘¸å¼€å§‹äº‹ä»¶
- âœ… **touchmove**: è§¦æ‘¸ç§»åŠ¨äº‹ä»¶
- âœ… **touchend**: è§¦æ‘¸ç»“æŸäº‹ä»¶
- âœ… **input**: è¾“å…¥æ–‡æœ¬
- âœ… **trigger**: è§¦å‘è‡ªå®šä¹‰äº‹ä»¶

#### 2. å±æ€§è¯»å– (6ä¸ªå·¥å…·)

- âœ… **getText**: è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
- âœ… **getAttribute**: è·å–å…ƒç´ å±æ€§ï¼ˆæ”¯æŒ data-* å±æ€§ï¼‰
- âœ… **getValue**: è·å–è¡¨å•å…ƒç´ å€¼
- âœ… **getProperty**: è·å–å…ƒç´ å±æ€§ï¼ˆJavaScript å±æ€§ï¼‰
- âœ… **getStyle**: è·å–å…ƒç´ æ ·å¼
- âœ… **getComputedStyle**: è·å–è®¡ç®—åæ ·å¼

#### 3. ä½ç½®å°ºå¯¸ (3ä¸ªå·¥å…·)

- âœ… **getSize**: è·å–å…ƒç´ å°ºå¯¸ï¼ˆwidth, heightï¼‰
- âœ… **getOffset**: è·å–å…ƒç´ åç§»ï¼ˆleft, topï¼‰
- âœ… **getBoundingClientRect**: è·å–å®Œæ•´è¾¹ç•Œä¿¡æ¯

#### 4. ç§»åŠ¨æ»‘åŠ¨ (3ä¸ªå·¥å…·)

- âœ… **swipe**: æ»‘åŠ¨å…ƒç´ ï¼ˆæ”¯æŒæ–¹å‘å’Œè·ç¦»ï¼‰
- âœ… **moveTo**: ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®
- âœ… **scrollTo**: æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®

#### 5. ä¸“ç”¨ç»„ä»¶æ“ä½œ (6ç±»å­ç±»å·¥å…·)

**Input / Textarea**:
- âœ… input_input: è¾“å…¥æ–‡æœ¬
- âœ… input_clear: æ¸…ç©ºå†…å®¹
- âœ… input_getValue: è·å–å€¼
- âœ… input_focus: èšç„¦
- âœ… input_blur: å¤±ç„¦

**Picker**:
- âœ… picker_select: é€‰æ‹©é€‰é¡¹ï¼ˆæ”¯æŒç´¢å¼•/å€¼ï¼‰
- âœ… picker_getValue: è·å–å½“å‰å€¼
- âœ… picker_getRange: è·å–é€‰é¡¹åˆ—è¡¨

**ScrollView**:
- âœ… scrollview_scrollTo: æ»šåŠ¨åˆ°ä½ç½®
- âœ… scrollview_scrollIntoView: æ»šåŠ¨åˆ°å­å…ƒç´ 
- âœ… scrollview_getScrollOffset: è·å–æ»šåŠ¨åç§»

**Swiper**:
- âœ… swiper_swipeTo: æ»‘åŠ¨åˆ°æŒ‡å®šé¡µ
- âœ… swiper_next: ä¸‹ä¸€é¡µ
- âœ… swiper_prev: ä¸Šä¸€é¡µ
- âœ… swiper_getCurrent: è·å–å½“å‰é¡µç´¢å¼•

**MovableView**:
- âœ… movable_moveTo: ç§»åŠ¨åˆ°ä½ç½®
- âœ… movable_getPosition: è·å–å½“å‰ä½ç½®

#### 6. ElementRef é›†æˆ

- âœ… æ‰€æœ‰å·¥å…·æ”¯æŒ ElementRef åè®®
- âœ… æ”¯æŒ refId/selector/xpath ä¸‰ç§æŸ¥è¯¢æ–¹å¼
- âœ… ç»Ÿä¸€çš„å…ƒç´ è§£æé€»è¾‘

### Out of Scope (ä¸åŒ…å«)

- âŒ å…ƒç´ æˆªå›¾ï¼ˆä½¿ç”¨ Page screenshotï¼‰
- âŒ æ‹–æ‹½åˆ°å…¶ä»–å…ƒç´ ï¼ˆä½¿ç”¨ touchstart + touchmove + touchend ç»„åˆï¼‰
- âŒ å¤æ‚æ‰‹åŠ¿è¯†åˆ«ï¼ˆç¼©æ”¾ã€æ—‹è½¬ç­‰ï¼‰
- âŒ åŠ¨ç”»çŠ¶æ€æ£€æµ‹

## Constraints (çº¦æŸ)

### Technical Constraints (æŠ€æœ¯çº¦æŸ)

1. **miniprogram-automator ä¾èµ–**
   - ä½¿ç”¨ Element å®ä¾‹çš„å®˜æ–¹ API
   - éµå¾ªè§¦æ‘¸äº‹ä»¶åæ ‡ç³»ç»Ÿ
   - æ­£ç¡®å¤„ç†å¼‚æ­¥æ“ä½œ

2. **è§¦æ‘¸äº‹ä»¶åæ ‡**
   - pageX/pageY: ç›¸å¯¹äºé¡µé¢çš„åæ ‡
   - clientX/clientY: ç›¸å¯¹äºè§†å£çš„åæ ‡
   - æ”¯æŒå¤šç‚¹è§¦æ‘¸ï¼ˆtouches æ•°ç»„ï¼‰

3. **é•¿æŒ‰æ—¶é—´**
   - é»˜è®¤: 350ms
   - ç¬¦åˆå¾®ä¿¡å°ç¨‹åºæ ‡å‡†

4. **å­ç±»ç»„ä»¶çº¦æŸ**
   - Picker: ä»…æ”¯æŒ selector/multiSelector/time/date æ¨¡å¼
   - ScrollView: æ”¯æŒæ¨ªå‘/çºµå‘æ»šåŠ¨
   - Swiper: æ”¯æŒå¾ªç¯/è‡ªåŠ¨æ’­æ”¾é…ç½®
   - MovableView: æ”¯æŒè¾¹ç•Œé™åˆ¶

### Business Constraints (ä¸šåŠ¡çº¦æŸ)

1. **äº¤äº’æ—¶é—´**: å•æ¬¡æ“ä½œ <1 ç§’
2. **é•¿æŒ‰æ—¶é—´**: 350msï¼ˆå›ºå®šï¼‰
3. **æ»‘åŠ¨æ—¶é—´**: å¯é…ç½®ï¼Œé»˜è®¤ 300ms
4. **å…¼å®¹æ€§**: æ”¯æŒæ‰€æœ‰å¾®ä¿¡å°ç¨‹åºåŸºç¡€ç»„ä»¶

## Success Criteria (æˆåŠŸæ ‡å‡†)

### Functional Criteria (åŠŸèƒ½æ ‡å‡†)

**åŸºç¡€äº¤äº’**:
- âœ… tap è§¦å‘ç‚¹å‡»äº‹ä»¶
- âœ… longpress è§¦å‘é•¿æŒ‰äº‹ä»¶
- âœ… touchstart/move/end æ”¯æŒè§¦æ‘¸äº‹ä»¶åºåˆ—
- âœ… input è¾“å…¥æ–‡æœ¬åˆ°è¡¨å•å…ƒç´ 
- âœ… trigger è§¦å‘è‡ªå®šä¹‰äº‹ä»¶

**å±æ€§è¯»å–**:
- âœ… getText è·å–æ–‡æœ¬å†…å®¹
- âœ… getAttribute è·å– HTML å±æ€§
- âœ… getValue è·å–è¡¨å•å€¼
- âœ… getProperty è·å– JavaScript å±æ€§
- âœ… getStyle/getComputedStyle è·å–æ ·å¼

**ä½ç½®å°ºå¯¸**:
- âœ… getSize è¿”å›å®½é«˜
- âœ… getOffset è¿”å›åç§»
- âœ… getBoundingClientRect è¿”å›å®Œæ•´è¾¹ç•Œ

**ç§»åŠ¨æ»‘åŠ¨**:
- âœ… swipe æ”¯æŒ 4 ä¸ªæ–¹å‘æ»‘åŠ¨
- âœ… moveTo ç§»åŠ¨åˆ°æŒ‡å®šåæ ‡
- âœ… scrollTo æ»šåŠ¨åˆ°ä½ç½®

**å­ç±»æ“ä½œ**:
- âœ… Input/Textarea è¾“å…¥æ“ä½œå®Œæ•´
- âœ… Picker é€‰æ‹©æ“ä½œå®Œæ•´
- âœ… ScrollView æ»šåŠ¨æ“ä½œå®Œæ•´
- âœ… Swiper ç¿»é¡µæ“ä½œå®Œæ•´
- âœ… MovableView ç§»åŠ¨æ“ä½œå®Œæ•´

### Quality Criteria (è´¨é‡æ ‡å‡†)

- âœ… TypeScript ç¼–è¯‘ 0 é”™è¯¯
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >85%
- âœ… 72 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… æ—  ESLint é”™è¯¯
- âœ… JSDoc æ³¨é‡Šå®Œæ•´ï¼ˆ956 è¡Œä»£ç ï¼‰

### Documentation Criteria (æ–‡æ¡£æ ‡å‡†)

- âœ… æ¯ä¸ªå·¥å…·æœ‰è¯¦ç»† schema å®šä¹‰
- âœ… å­ç±»æ“ä½œåˆ†ç±»æ¸…æ™°
- âœ… åæ ‡ç³»ç»Ÿæ–‡æ¡£å®Œæ•´
- â³ charter.C4.align.yaml (æœ¬æ–‡æ¡£)
- â³ tasks.C4.atomize.md (ä»»åŠ¡å¡)

## Definition of Done (å®Œæˆæ ‡å‡†)

**ä»£ç **:
- âœ… `src/tools/element.ts` å®ç°å®Œæˆ (956 lines)
- âœ… TypeScript ç¼–è¯‘é€šè¿‡
- âœ… 23 ä¸ªæ ¸å¿ƒå·¥å…· + 6 ç±»å­ç±»æ“ä½œæ­£ç¡®æ³¨å†Œ

**æµ‹è¯•**:
- âœ… `tests/unit/element.test.ts` (1104 lines)
- âœ… 72 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… è¦†ç›–æ‰€æœ‰å·¥å…·å’Œå­ç±»æ“ä½œ
- âœ… Mock Element å®ä¾‹

**æ–‡æ¡£**:
- â³ charter.C4.align.yaml (è¿½æº¯)
- â³ tasks.C4.atomize.md (è¿½æº¯)
- âœ… README å·¥å…·åˆ—è¡¨æ›´æ–°

**Git**:
- âœ… å·²æäº¤ï¼ˆStage C æäº¤ï¼‰

## Dependencies (ä¾èµ–)

**å‰ç½®ä»»åŠ¡**:
- âœ… C3: Page å·¥å…·ï¼ˆquery è·å–å…ƒç´ ï¼‰
- âœ… ElementRef åè®®å®ç°
- âœ… B2: SessionStoreï¼ˆç®¡ç†å…ƒç´ ç¼“å­˜ï¼‰

**åç»­ä»»åŠ¡**:
- C4 â†’ C5 (å·¥å…·æ³¨å†Œå™¨é›†æˆ)
- C4 â†’ D1 (Assert å·¥å…·ä½¿ç”¨ Element å±æ€§)

## Risks (é£é™©)

### Technical Risks (æŠ€æœ¯é£é™©)

1. **è§¦æ‘¸äº‹ä»¶å¤æ‚æ€§** - ğŸŸ¡ ä¸­é£é™©
   - å½±å“ï¼šå¤šç‚¹è§¦æ‘¸å’Œäº‹ä»¶åºåˆ—å¯èƒ½å‡ºé”™
   - ç¼“è§£ï¼šå®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–

2. **å­ç±»ç»„ä»¶å…¼å®¹æ€§** - ğŸŸ¡ ä¸­é£é™©
   - å½±å“ï¼šä¸åŒç»„ä»¶å¯èƒ½æœ‰ç‰¹æ®Šè¡Œä¸º
   - ç¼“è§£ï¼šå‚è€ƒå®˜æ–¹æ–‡æ¡£å®ç°

3. **åæ ‡ç³»ç»Ÿæ··æ·†** - ğŸŸ¢ å·²ç¼“è§£
   - é£é™©ï¼špageX å’Œ clientX æ··ç”¨
   - ç¼“è§£ï¼šç»Ÿä¸€ä½¿ç”¨ pageX/pageY

### Business Risks (ä¸šåŠ¡é£é™©)

1. **æ€§èƒ½é—®é¢˜** - ğŸŸ¢ å·²ç¼“è§£
   - å½±å“ï¼šå¤§é‡å…ƒç´ æ“ä½œå¯èƒ½å½±å“æ€§èƒ½
   - ç¼“è§£ï¼šä½¿ç”¨å…ƒç´ ç¼“å­˜ä¼˜åŒ–

## Open Questions (æœªå†³é—®é¢˜)

- â“ æ˜¯å¦éœ€è¦æ”¯æŒæ‹–æ‹½åˆ°å…¶ä»–å…ƒç´ ï¼Ÿï¼ˆå½“å‰ä½¿ç”¨è§¦æ‘¸äº‹ä»¶ç»„åˆï¼‰
- â“ æ˜¯å¦éœ€è¦æ”¯æŒå¤æ‚æ‰‹åŠ¿ï¼ˆç¼©æ”¾ã€æ—‹è½¬ï¼‰ï¼Ÿï¼ˆå½“å‰ä¸æ”¯æŒï¼‰
- â“ æ˜¯å¦éœ€è¦æ”¯æŒåŠ¨ç”»çŠ¶æ€æ£€æµ‹ï¼Ÿï¼ˆå½“å‰ä¸æ”¯æŒï¼‰

## References (å‚è€ƒèµ„æ–™)

- `docs/å¾®ä¿¡å°ç¨‹åºè‡ªåŠ¨åŒ–å®Œæ•´æ“ä½œæ‰‹å†Œ.md` - Element API æ–‡æ¡£
- `docs/å®Œæ•´å®ç°æ–¹æ¡ˆ.md` - å·¥å…·åˆ†å±‚è®¾è®¡
- `miniprogram-automator` å®˜æ–¹æ–‡æ¡£
- å¾®ä¿¡å°ç¨‹åºç»„ä»¶æ–‡æ¡£

---

**Approval**: âœ… RETROSPECTIVE APPROVED
**Implementation**: âœ… COMPLETED (23ä¸ªå·¥å…· + 6ç±»å­ç±»æ“ä½œ)
**Documentation**: â³ IN PROGRESS
