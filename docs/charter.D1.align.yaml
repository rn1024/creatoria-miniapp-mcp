# Charter: [D1] æ–­è¨€å·¥å…·é›†

task_id: D1
task_name: æ–­è¨€å·¥å…·é›†å®ç°
stage: D
phase: Align (Retrospective)
created_at: "2025-10-02"
status: COMPLETED
estimated_hours: 2-3
actual_hours: 2.5

## Goal (ç›®æ ‡)

å®ç°å®Œæ•´çš„æ–­è¨€å·¥å…·é›†ï¼Œä¸ºå°ç¨‹åºè‡ªåŠ¨åŒ–æµ‹è¯•æä¾›å¼ºå¤§çš„éªŒè¯èƒ½åŠ›ã€‚

**æ ¸å¿ƒäº¤ä»˜ç‰©**:
- `src/tools/assert.ts` - 9 ä¸ªæ–­è¨€å·¥å…·å®ç° (465 lines)
- `tests/unit/assert.test.ts` - å•å…ƒæµ‹è¯• (394 lines, 27 tests)
- å·¥å…·: assertExists, assertNotExists, assertText, assertTextContains, assertValue, assertAttribute, assertProperty, assertData, assertVisible

## Non-Goals (éç›®æ ‡)

- âŒ ä¸å®ç°è‡ªå®šä¹‰æ–­è¨€é€»è¾‘ï¼ˆä»…æ ‡å‡†æ–­è¨€ï¼‰
- âŒ ä¸å®ç°è½¯æ–­è¨€ï¼ˆæ‰€æœ‰æ–­è¨€å¤±è´¥å³æŠ›é”™ï¼‰
- âŒ ä¸å®ç°æ–­è¨€ç»“æœèšåˆæŠ¥å‘Šï¼ˆç•™ç»™æœªæ¥ï¼‰
- âŒ ä¸å®ç°å¿«ç…§æ¯”å¯¹ï¼ˆå±äº D2ï¼‰

## Scope (èŒƒå›´)

### In Scope (åŒ…å«)

1. **å…ƒç´ å­˜åœ¨æ€§æ–­è¨€**
   - âœ… assertExists - æ–­è¨€å…ƒç´ å­˜åœ¨
   - âœ… assertNotExists - æ–­è¨€å…ƒç´ ä¸å­˜åœ¨
   - âœ… æ”¯æŒ selector å’Œ pagePath å‚æ•°

2. **æ–‡æœ¬å†…å®¹æ–­è¨€**
   - âœ… assertText - ç²¾ç¡®æ–‡æœ¬åŒ¹é…
   - âœ… assertTextContains - æ–‡æœ¬åŒ…å«å­ä¸²
   - âœ… è¿”å›æœŸæœ›å€¼å’Œå®é™…å€¼å¯¹æ¯”

3. **è¡¨å•å€¼æ–­è¨€**
   - âœ… assertValue - input/textarea å€¼æ–­è¨€
   - âœ… æ”¯æŒä»»æ„è¡¨å•ç»„ä»¶

4. **å±æ€§å’ŒçŠ¶æ€æ–­è¨€**
   - âœ… assertAttribute - HTML å±æ€§æ–­è¨€
   - âœ… assertProperty - JavaScript å±æ€§æ–­è¨€
   - âœ… assertVisible - å¯è§æ€§æ–­è¨€ï¼ˆåŸºäºå°ºå¯¸ï¼‰

5. **é¡µé¢æ•°æ®æ–­è¨€**
   - âœ… assertData - Page data æ–­è¨€
   - âœ… æ”¯æŒåµŒå¥—è·¯å¾„è®¿é—®

### Out of Scope (ä¸åŒ…å«)

- âŒ æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼ˆä½¿ç”¨å­—ç¬¦ä¸²ç²¾ç¡®/åŒ…å«åŒ¹é…ï¼‰
- âŒ æ•°å€¼èŒƒå›´æ–­è¨€ï¼ˆä½¿ç”¨ç²¾ç¡®åŒ¹é…ï¼‰
- âŒ æ•°ç»„é•¿åº¦/å†…å®¹æ–­è¨€ï¼ˆä½¿ç”¨ JSON æ¯”è¾ƒï¼‰
- âŒ è‡ªå®šä¹‰åŒ¹é…å™¨

## Constraints (çº¦æŸ)

### Technical Constraints (æŠ€æœ¯çº¦æŸ)

1. **å·¥å…·ä¾èµ–**
   - å¤ç”¨ Page å·¥å…·ï¼ˆquery, getDataï¼‰
   - å¤ç”¨ Element å·¥å…·ï¼ˆgetText, getValue, getAttribute, etc.ï¼‰
   - é€šè¿‡å‡½æ•°è°ƒç”¨è€Œéç›´æ¥ SessionState è®¿é—®

2. **é”™è¯¯æ ¼å¼**
   - æ‰€æœ‰æ–­è¨€å¤±è´¥æŠ›å‡º Error
   - é”™è¯¯æ¶ˆæ¯æ ¼å¼: `Assertion failed: <è¯¦ç»†è¯´æ˜>`
   - åŒ…å«æœŸæœ›å€¼ vs å®é™…å€¼å¯¹æ¯”

3. **è¿”å›å€¼ç»“æ„**
   - æˆåŠŸ: `{ success: true, message: string, actual?: any }`
   - å¤±è´¥: æŠ›å‡º Errorï¼ˆä¸è¿”å› success: falseï¼‰

4. **æ—¥å¿—è®°å½•**
   - ä½¿ç”¨ session.logger è®°å½•æ‰€æœ‰æ–­è¨€
   - åŒ…å« infoï¼ˆæˆåŠŸï¼‰å’Œ errorï¼ˆå¤±è´¥ï¼‰

### Business Constraints (ä¸šåŠ¡çº¦æŸ)

1. **æ‰§è¡Œæ—¶é—´**: å•ä¸ªæ–­è¨€ <500ms
2. **é”™è¯¯ä¿¡æ¯**: å¿…é¡»æ¸…æ™°æŒ‡æ˜å¤±è´¥åŸå› 
3. **å¯ç»„åˆæ€§**: å¯åœ¨æµ‹è¯•æµç¨‹ä¸­é“¾å¼ä½¿ç”¨

## Success Criteria (æˆåŠŸæ ‡å‡†)

### Functional Criteria (åŠŸèƒ½æ ‡å‡†)

- âœ… assertExists æ­£ç¡®æ£€æµ‹å…ƒç´ å­˜åœ¨æ€§
- âœ… assertNotExists æ­£ç¡®æ£€æµ‹å…ƒç´ ä¸å­˜åœ¨
- âœ… assertText ç²¾ç¡®åŒ¹é…æ–‡æœ¬å†…å®¹
- âœ… assertTextContains æ£€æµ‹å­ä¸²åŒ…å«
- âœ… assertValue éªŒè¯è¡¨å•å€¼
- âœ… assertAttribute éªŒè¯ HTML å±æ€§
- âœ… assertProperty éªŒè¯ JS å±æ€§
- âœ… assertData éªŒè¯é¡µé¢æ•°æ®ï¼ˆå«åµŒå¥—ï¼‰
- âœ… assertVisible éªŒè¯å…ƒç´ å¯è§æ€§ï¼ˆéé›¶å°ºå¯¸ï¼‰

### Quality Criteria (è´¨é‡æ ‡å‡†)

- âœ… TypeScript ç¼–è¯‘ 0 é”™è¯¯
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >90%
- âœ… 27 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… æ—  ESLint é”™è¯¯
- âœ… JSDoc æ³¨é‡Šå®Œæ•´

### Documentation Criteria (æ–‡æ¡£æ ‡å‡†)

- âœ… æ¯ä¸ªå·¥å…·æœ‰å‡½æ•°ç­¾åå’Œ JSDoc
- âœ… é”™è¯¯æ¶ˆæ¯æ ¼å¼ç»Ÿä¸€
- â³ charter.D1.align.yaml (æœ¬æ–‡æ¡£)
- â³ tasks.D1.atomize.md (ä»»åŠ¡å¡)

## Definition of Done (å®Œæˆæ ‡å‡†)

**ä»£ç **:
- âœ… `src/tools/assert.ts` å®ç°å®Œæˆ (465 lines)
- âœ… 9 ä¸ªæ–­è¨€å·¥å…·å…¨éƒ¨å®ç°
- âœ… TypeScript ç¼–è¯‘é€šè¿‡

**æµ‹è¯•**:
- âœ… `tests/unit/assert.test.ts` (394 lines)
- âœ… 27 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… è¦†ç›–æˆåŠŸå’Œå¤±è´¥åœºæ™¯
- âœ… Mock page/element å·¥å…·ä¾èµ–

**æ–‡æ¡£**:
- â³ charter.D1.align.yaml (è¿½æº¯)
- â³ tasks.D1.atomize.md (è¿½æº¯)
- âœ… ä»£ç æ³¨é‡Šå®Œæ•´

**Git**:
- âœ… å·²æäº¤ï¼ˆcommit: feat: [D1] æ–­è¨€å·¥å…·é›†å®ç°ï¼‰

## Dependencies (ä¾èµ–)

**å‰ç½®ä»»åŠ¡**:
- âœ… C3: Page å·¥å…·ï¼ˆquery, getDataï¼‰
- âœ… C4: Element å·¥å…·ï¼ˆgetText, getValue, getAttribute, getProperty, getSizeï¼‰
- âœ… B2: SessionState å’Œæ—¥å¿—ç³»ç»Ÿ

**åç»­ä»»åŠ¡**:
- D1 â†’ Stage E (é›†æˆåˆ°å·¥å…·æ³¨å†Œå™¨)
- D1 â†’ Stage F (ç«¯åˆ°ç«¯æµ‹è¯•ç¤ºä¾‹)

## Risks (é£é™©)

### Technical Risks (æŠ€æœ¯é£é™©)

1. **æ–­è¨€æ€§èƒ½** - ğŸŸ¢ ä½é£é™©
   - å½±å“ï¼šå¤§é‡æ–­è¨€å¯èƒ½æ‹–æ…¢æµ‹è¯•
   - ç¼“è§£ï¼šæ¯ä¸ªæ–­è¨€åŸºäºå•æ¬¡å…ƒç´ /æ•°æ®æŸ¥è¯¢

2. **é”™è¯¯æ¶ˆæ¯å¯è¯»æ€§** - ğŸŸ¢ å·²ç¼“è§£
   - é£é™©ï¼šæœŸæœ›å€¼ vs å®é™…å€¼ä¸æ¸…æ™°
   - ç¼“è§£ï¼šç»Ÿä¸€æ ¼å¼ `Expected: "...", Actual: "..."`

3. **æ·±åº¦åµŒå¥—æ•°æ®æ¯”è¾ƒ** - ğŸŸ¡ ä¸­é£é™©
   - é£é™©ï¼šJSON.stringify å¯èƒ½æ— æ³•æ­£ç¡®æ¯”è¾ƒå¤æ‚å¯¹è±¡
   - ç¼“è§£ï¼šå½“å‰ä½¿ç”¨ JSON åºåˆ—åŒ–æ¯”è¾ƒï¼Œæœªæ¥å¯å¼•å…¥æ·±åº¦æ¯”è¾ƒåº“

### Business Risks (ä¸šåŠ¡é£é™©)

1. **æ–­è¨€å¤±è´¥å®šä½** - ğŸŸ¢ å·²ç¼“è§£
   - å½±å“ï¼šç”¨æˆ·ä¸çŸ¥é“å“ªä¸ªæ–­è¨€å¤±è´¥
   - ç¼“è§£ï¼šé”™è¯¯æ¶ˆæ¯åŒ…å« selector/refId/path ä¿¡æ¯

## Open Questions (æœªå†³é—®é¢˜)

- â“ æ˜¯å¦éœ€è¦æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Ÿï¼ˆå½“å‰ä»…å­—ç¬¦ä¸²ï¼‰
- â“ æ˜¯å¦éœ€è¦è½¯æ–­è¨€ï¼ˆæ”¶é›†æ‰€æœ‰å¤±è´¥åç»Ÿä¸€æŠ¥å‘Šï¼‰ï¼Ÿï¼ˆå½“å‰ç¡¬æ–­è¨€ï¼‰
- â“ æ˜¯å¦éœ€è¦è‡ªå®šä¹‰åŒ¹é…å™¨æ‰©å±•æœºåˆ¶ï¼Ÿï¼ˆå½“å‰å›ºå®š 9 ä¸ªå·¥å…·ï¼‰

## References (å‚è€ƒèµ„æ–™)

- `docs/å®Œæ•´å®ç°æ–¹æ¡ˆ.md` - å·¥å…·åˆ†å±‚è®¾è®¡
- `src/tools/page.ts` - Page å·¥å…·ä¾èµ–
- `src/tools/element.ts` - Element å·¥å…·ä¾èµ–
- Playwright Assertions - æ–­è¨€è®¾è®¡å‚è€ƒ

---

**Approval**: âœ… RETROSPECTIVE APPROVED
**Implementation**: âœ… COMPLETED
**Documentation**: â³ IN PROGRESS
