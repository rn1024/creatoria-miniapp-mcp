# å¾®ä¿¡å°ç¨‹åºè‡ªåŠ¨åŒ–å®Œæ•´æ“ä½œæ‰‹å†Œ

> å®˜æ–¹æ–‡æ¡£ï¼š<https://developers.weixin.qq.com/miniprogram/dev/devtools/auto/quick-start.html>
>
> æœ¬æ–‡æ¡£æ¶µç›–æ‰€æœ‰å¯ç”¨çš„è‡ªåŠ¨åŒ–æ¥å£å’Œæ“ä½œåŠŸèƒ½

---

## ğŸ“‘ ç›®å½•

- [1. å¿«é€Ÿå…¥é—¨](#1-å¿«é€Ÿå…¥é—¨)
- [2. Automator API](#2-automator-api)
- [3. MiniProgram API](#3-miniprogram-api)
- [4. Page API](#4-page-api)
- [5. Element API](#5-element-api)
- [6. å¸¸ç”¨ç¤ºä¾‹](#6-å¸¸ç”¨ç¤ºä¾‹)
- [7. çœŸæœºè‡ªåŠ¨åŒ–](#7-çœŸæœºè‡ªåŠ¨åŒ–)
- [8. å½•åˆ¶å›æ”¾](#8-å½•åˆ¶å›æ”¾)
- [9. FAQ](#9-faq)

---

## 1. å¿«é€Ÿå…¥é—¨

### 1.1 è¿è¡Œç¯å¢ƒ

- **Node.js**: ç‰ˆæœ¬å¤§äº 8.0
- **åŸºç¡€åº“**: ç‰ˆæœ¬ `2.7.3` åŠä»¥ä¸Š
- **å¼€å‘è€…å·¥å…·**: ç‰ˆæœ¬ `1.02.1907232` åŠä»¥ä¸Š

### 1.2 å®‰è£…

```bash
npm i miniprogram-automator --save-dev
```

### 1.3 ä½¿ç”¨

**ç¬¬ä¸€æ­¥**ï¼šå¼€å¯å·¥å…·å®‰å…¨è®¾ç½®ä¸­çš„ **CLI/HTTP è°ƒç”¨åŠŸèƒ½**

> âš ï¸ å¿…é¡»å¼€å¯ä»¥ä¸Šé€‰é¡¹ï¼Œå¦åˆ™ SDK å°†æ— æ³•æ­£å¸¸å¯åŠ¨å·¥å…·è‡ªåŠ¨åŒ–åŠŸèƒ½

**ç¬¬äºŒæ­¥**ï¼šç¼–å†™æ§åˆ¶è„šæœ¬

```javascript
const automator = require('miniprogram-automator')

automator.launch({
  cliPath: 'path/to/cli', // å·¥å…· cli ä½ç½®ï¼Œé»˜è®¤å®‰è£…ä½ç½®å¯å¿½ç•¥
  projectPath: 'path/to/project', // é¡¹ç›®æ–‡ä»¶åœ°å€
}).then(async miniProgram => {
  const page = await miniProgram.reLaunch('/page/component/index')
  await page.waitFor(500)
  const element = await page.$('.kind-list-item-hd')
  console.log(await element.attribute('class'))
  await element.tap()
  await miniProgram.close()
})
```

**ç¬¬ä¸‰æ­¥**ï¼šæ‰§è¡Œè„šæœ¬

```bash
node path/to/script
```

---

## 2. Automator API

Automator æ¨¡å—æä¾›äº†å¯åŠ¨åŠè¿æ¥å¼€å‘è€…å·¥å…·çš„æ–¹æ³•ã€‚

### 2.1 automator.connect

è¿æ¥å¼€å‘è€…å·¥å…·ã€‚

```typescript
automator.connect(options: Object): Promise<MiniProgram>
```

**å‚æ•°è¯´æ˜**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| wsEndpoint | string | æ˜¯ | - | å¼€å‘è€…å·¥å…· WebSocket åœ°å€ |

**å‘½ä»¤è¡Œå‚æ•°**

- `--auto <project_root>`: æ‰“å¼€æŒ‡å®šé¡¹ç›®å¹¶å¼€å¯è‡ªåŠ¨åŒ–åŠŸèƒ½
- `--auto-port <port>`: æŒ‡å®šè‡ªåŠ¨åŒ–ç›‘å¬ç«¯å£

```bash
cli --auto /Users/username/demo --auto-port 9420
```

**ç¤ºä¾‹ä»£ç **

```javascript
automator.connect({
  wsEndpoint: 'ws://localhost:9420'
}).then(async miniProgram => {
  const page = await miniProgram.navigateTo('/page/component/index')
  await page.setData({})
})
```

### 2.2 automator.launch

å¯åŠ¨å¹¶è¿æ¥å¼€å‘è€…å·¥å…·ã€‚

> âš ï¸ ç¡®ä¿å·¥å…·å®‰å…¨è®¾ç½®ä¸­å·²å¼€å¯ CLI/HTTP è°ƒç”¨åŠŸèƒ½

```typescript
automator.launch(options: Object): Promise<MiniProgram>
```

**å‚æ•°è¯´æ˜**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| cliPath | string | å¦ | - | å¼€å‘è€…å·¥å…·å‘½ä»¤è¡Œå·¥å…·ç»å¯¹è·¯å¾„ |
| projectPath | string | æ˜¯ | - | é¡¹ç›®ç»å¯¹è·¯å¾„ |
| timeout | number | å¦ | 30000 | å¯åŠ¨æœ€é•¿ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |
| port | number | å¦ | - | WebSocket ç«¯å£å· |
| account | string | å¦ | - | ç”¨æˆ· openid |
| projectConfig | Object | å¦ | - | è¦†ç›– project.config.json ä¸­çš„é…ç½® |
| ticket | string | å¦ | - | å¼€å‘è€…å·¥å…·ç™»å½•ç¥¨æ® |

**cliPath é»˜è®¤ä½ç½®**

- **Mac**: `/Applications/wechatwebdevtools.app/Contents/MacOS/cli`
- **Windows**: `C:/Program Files (x86)/Tencent/å¾®ä¿¡webå¼€å‘è€…å·¥å…·/cli.bat`

**ç¤ºä¾‹ä»£ç **

```javascript
automator.launch({
  cliPath: 'path/to/cli',
  projectPath: 'path/to/project',
  projectConfig: {
    setting: {
      autoAudits: true,
    },
  },
}).then(async miniProgram => {
  const page = await miniProgram.navigateTo('/page/component/index')
  await page.setData({})
})
```

---

## 3. MiniProgram API

MiniProgram æ¨¡å—æä¾›äº†æ§åˆ¶å°ç¨‹åºçš„æ–¹æ³•ã€‚

### 3.1 é¡µé¢å¯¼èˆªæ–¹æ³•

#### 3.1.1 miniProgram.pageStack

è·å–å°ç¨‹åºé¡µé¢å †æ ˆã€‚

```typescript
miniProgram.pageStack(): Promise<Page[]>
```

#### 3.1.2 miniProgram.navigateTo

ä¿ç•™å½“å‰é¡µé¢ï¼Œè·³è½¬åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢ï¼ŒåŒ `wx.navigateTo`ã€‚

```typescript
miniProgram.navigateTo(url: string): Promise<Page>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| url | string | æ˜¯ | éœ€è¦è·³è½¬çš„åº”ç”¨å†…é tabBar çš„é¡µé¢çš„è·¯å¾„ |

#### 3.1.3 miniProgram.redirectTo

å…³é—­å½“å‰é¡µé¢ï¼Œè·³è½¬åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢ï¼ŒåŒ `wx.redirectTo`ã€‚

```typescript
miniProgram.redirectTo(url: string): Promise<Page>
```

#### 3.1.4 miniProgram.navigateBack

å…³é—­å½“å‰é¡µé¢ï¼Œè¿”å›ä¸Šä¸€é¡µé¢æˆ–å¤šçº§é¡µé¢ï¼ŒåŒ `wx.navigateBack`ã€‚

```typescript
miniProgram.navigateBack(): Promise<Page>
```

#### 3.1.5 miniProgram.reLaunch

å…³é—­æ‰€æœ‰é¡µé¢ï¼Œæ‰“å¼€åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢ï¼ŒåŒ `wx.reLaunch`ã€‚

```typescript
miniProgram.reLaunch(url: string): Promise<Page>
```

#### 3.1.6 miniProgram.switchTab

è·³è½¬åˆ° tabBar é¡µé¢ï¼Œå¹¶å…³é—­å…¶ä»–æ‰€æœ‰é tabBar é¡µé¢ï¼ŒåŒ `wx.switchTab`ã€‚

```typescript
miniProgram.switchTab(url: string): Promise<Page>
```

#### 3.1.7 miniProgram.currentPage

è·å–å½“å‰é¡µé¢ã€‚

```typescript
miniProgram.currentPage(): Promise<Page>
```

### 3.2 ç³»ç»Ÿä¿¡æ¯æ–¹æ³•

#### 3.2.1 miniProgram.systemInfo

è·å–ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ `wx.getSystemInfo`ã€‚

```typescript
miniProgram.systemInfo(): Promise<Object>
```

**ç¤ºä¾‹ä»£ç **

```javascript
const systemInfo = await miniProgram.systemInfo()
if (systemInfo.platform === 'devtools') {
  // Do something
}
```

### 3.3 æ–¹æ³•è°ƒç”¨ä¸Mock

#### 3.3.1 miniProgram.callWxMethod

è°ƒç”¨ wx å¯¹è±¡ä¸Šçš„æŒ‡å®šæ–¹æ³•ã€‚

```typescript
miniProgram.callWxMethod(method: string, ...args: any[]): Promise<any>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| method | string | æ˜¯ | éœ€è¦è°ƒç”¨çš„æ–¹æ³•å |
| ...args | array\<any\> | å¦ | æ–¹æ³•å‚æ•° |

> ğŸ’¡ è°ƒç”¨å¼‚æ­¥æ–¹æ³•æ—¶æ— éœ€ä¼ å…¥ success åŠ fail å›è°ƒå‡½æ•°

**ç¤ºä¾‹ä»£ç **

```javascript
await miniProgram.callWxMethod('setStorage', {
  key: 'test',
  data: 'test'
})
const { data } = await miniProgram.callWxMethod('getStorageSync', 'test')
console.log(data) // -> 'test'
```

#### 3.3.2 miniProgram.callPluginWxMethod

> ğŸ“Œ åŸºç¡€åº“ 2.19.3 å¼€å§‹æ”¯æŒ

è°ƒç”¨æ’ä»¶ wx å¯¹è±¡ä¸Šçš„æŒ‡å®šæ–¹æ³•ï¼Œç”¨æ³•åŒ `miniProgram.callWxMethod`ã€‚

```typescript
miniProgram.callPluginWxMethod(pluginId: string, method: string, ...args: any[]): Promise<any>
```

#### 3.3.3 miniProgram.mockWxMethod

> ğŸ“Œ ä¼ å…¥å‡½æ•°åŠŸèƒ½ automator 0.9.0ï¼ŒåŸºç¡€åº“ 2.9.5 å¼€å§‹æ”¯æŒ

è¦†ç›– wx å¯¹è±¡ä¸ŠæŒ‡å®šæ–¹æ³•çš„è°ƒç”¨ç»“æœã€‚

```typescript
miniProgram.mockWxMethod(method: string, result: any): Promise<void>
miniProgram.mockWxMethod(method: string, fn: Function | string, ...args: any[]): Promise<void>
```

**å‚æ•°è¯´æ˜ - æ–¹å¼ä¸€**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| method | string | æ˜¯ | éœ€è¦è¦†ç›–çš„æ–¹æ³•å |
| result | any | æ˜¯ | æŒ‡å®šè°ƒç”¨ç»“æœ |

**å‚æ•°è¯´æ˜ - æ–¹å¼äºŒ**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| method | string | æ˜¯ | éœ€è¦è¦†ç›–çš„æ–¹æ³•å |
| fn | Function \| string | æ˜¯ | å¤„ç†è¿”å›å‡½æ•° |
| ...args | array\<any\> | å¦ | ä¼ å…¥å‚æ•° |

> âš ï¸ fn åŒ `miniProgram.evaluate` çš„ appFunction å‚æ•°ä¸€æ ·ï¼Œæ— æ³•ä½¿ç”¨é—­åŒ…æ¥å¼•ç”¨å¤–éƒ¨å˜é‡ã€‚æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥åœ¨æ–¹æ³•å†…ä½¿ç”¨ `this.origin` æ¥è°ƒç”¨åŸå§‹æ–¹æ³•ã€‚

**ç¤ºä¾‹ä»£ç **

```javascript
// æ–¹å¼ä¸€ï¼šç›´æ¥æŒ‡å®šç»“æœ
await miniProgram.mockWxMethod('showModal', {
  confirm: true,
  cancel: false
})

// æ–¹å¼äºŒï¼šä½¿ç”¨å‡½æ•°å¤„ç†
await miniProgram.mockWxMethod(
  'getStorageSync',
  function(key, defVal) {
    if (key === 'name') return 'redhoodsu'
    if (key === 'sex') return 'male'
    return defVal
  },
  'unknown',
)

// æ›´æ”¹ getSystemInfo ä¸­çš„ platform å­—æ®µ
await miniProgram.mockWxMethod(
  'getSystemInfo',
  function(obj, platform) {
    return new Promise(resolve => {
      this.origin({
        success(res) {
          res.platform = platform
          resolve(res)
        },
      })
    })
  },
  'test',
)
```

#### 3.3.4 miniProgram.mockPluginWxMethod

> ğŸ“Œ åŸºç¡€åº“ 2.19.3 å¼€å§‹æ”¯æŒ

è¦†ç›–æ’ä»¶ wx å¯¹è±¡ä¸ŠæŒ‡å®šæ–¹æ³•çš„è°ƒç”¨ç»“æœï¼Œç”¨æ³•åŒ `miniProgram.mockWxMethod`ã€‚

```typescript
miniProgram.mockPluginWxMethod(pluginId: string, method: string, result: any): Promise<void>
miniProgram.mockPluginWxMethod(pluginId: string, method: string, fn: Function | string, ...args: any[]): Promise<void>
```

#### 3.3.5 miniProgram.restoreWxMethod

é‡ç½® wx æŒ‡å®šæ–¹æ³•ï¼Œæ¶ˆé™¤ mockWxMethod è°ƒç”¨çš„å½±å“ã€‚

```typescript
miniProgram.restoreWxMethod(method: string): Promise<void>
```

**ç¤ºä¾‹ä»£ç **

```javascript
console.log(await miniProgram.callWxMethod('getStorageSync', 'test')) // -> ''
await miniProgram.mockWxMethod('getStorageSync', 'mockValue')
console.log(await miniProgram.callWxMethod('getStorageSync', 'test')) // -> 'mockValue'
await miniProgram.restoreWxMethod('getStorageSync')
console.log(await miniProgram.callWxMethod('getStorageSync', 'test')) // -> ''
```

#### 3.3.6 miniProgram.restorePluginWxMethod

> ğŸ“Œ åŸºç¡€åº“ 2.19.3 å¼€å§‹æ”¯æŒ

é‡ç½®æ’ä»¶ wx æŒ‡å®šæ–¹æ³•ï¼Œæ¶ˆé™¤ mockPluginWxMethod è°ƒç”¨çš„å½±å“ï¼Œç”¨æ³•åŒ `miniProgram.restoreWxMethod`ã€‚

```typescript
miniProgram.restorePluginWxMethod(pluginId: string, method: string): Promise<void>
```

### 3.4 ä»£ç æ‰§è¡Œæ–¹æ³•

#### 3.4.1 miniProgram.evaluate

å¾€ AppService æ³¨å…¥ä»£ç ç‰‡æ®µå¹¶è¿”å›æ‰§è¡Œç»“æœã€‚

```typescript
miniProgram.evaluate(appFunction: Function | string, ...args: any[]): Promise<any>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| appFunction | Function \| string | æ˜¯ | ä»£ç ç‰‡æ®µ |
| ...args | array\<any\> | å¦ | æ‰§è¡Œæ—¶ä¼ å…¥å‚æ•° |

> âš ï¸ appFunction æœ€ç»ˆä¼šè¢«åºåˆ—åŒ–ä¼ é€’åˆ°å¼€å‘è€…å·¥å…·ï¼Œå› æ­¤ä½ æ— æ³•åœ¨å‡½æ•°ä¸­åˆ©ç”¨é—­åŒ…æ¥å¼•ç”¨å¤–éƒ¨å˜é‡ã€‚

**ç¤ºä¾‹ä»£ç **

```javascript
// æ–¹å¼ä¸€ï¼šä½¿ç”¨ Promise
let systemInfo = await miniProgram.evaluate(() => {
  return new Promise(resolve => {
    wx.getSystemInfo({
      success(result) {
        resolve(result)
      }
    })
  })
})

// æ–¹å¼äºŒï¼šåŒæ­¥æ–¹æ³•
systemInfo = await miniProgram.evaluate(() => {
  return wx.getSystemInfoSync()
})

// æ–¹å¼ä¸‰ï¼šå¸¦å‚æ•°
await miniProgram.evaluate(key => {
  wx.setStorageSync(key, 'test')
}, 'test')

// è·å–å…¨å±€æ•°æ®
const hasLogin = await miniProgram.evaluate(() => getApp().globalData.hasLogin)
```

### 3.5 é¡µé¢æ“ä½œæ–¹æ³•

#### 3.5.1 miniProgram.pageScrollTo

å°†é¡µé¢æ»šåŠ¨åˆ°ç›®æ ‡ä½ç½®ï¼ŒåŒ `wx.pageScrollTo`ã€‚

```typescript
miniProgram.pageScrollTo(scrollTop: number): Promise<void>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| scrollTop | number | æ˜¯ | æ»šåŠ¨åˆ°é¡µé¢çš„ç›®æ ‡ä½ç½®ï¼Œå•ä½ px |

**ç¤ºä¾‹ä»£ç **

```javascript
await miniProgram.pageScrollTo(50)
```

#### 3.5.2 miniProgram.screenshot

> ğŸ“Œ automator 0.9.0ï¼ŒåŸºç¡€åº“ 2.9.5ï¼Œå¼€å‘è€…å·¥å…· 1.02.2001082 å¼€å§‹æ”¯æŒ

å¯¹å½“å‰é¡µé¢æˆªå›¾ï¼Œç›®å‰åªæœ‰å¼€å‘è€…å·¥å…·æ¨¡æ‹Ÿå™¨æ”¯æŒï¼Œå®¢æˆ·ç«¯æ— æ³•ä½¿ç”¨ã€‚

```typescript
miniProgram.screenshot(options?: Object): Promise<string | void>
```

**å‚æ•°è¯´æ˜**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| options | Object | å¦ | - | æˆªå›¾é€‰é¡¹ |

å¦‚æœä¸ä¼  optionsï¼Œè¯¥æ–¹æ³•è¿”å›å›¾ç‰‡æ•°æ®çš„ base64 ç¼–ç ã€‚

**options å­—æ®µ**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| path | string | æ˜¯ | å›¾ç‰‡ä¿å­˜è·¯å¾„ |

**ç¤ºä¾‹ä»£ç **

```javascript
await miniProgram.screenshot({
  path: 'screenshot.png'
})
```

### 3.6 é«˜çº§åŠŸèƒ½

#### 3.6.1 miniProgram.exposeFunction

åœ¨ AppService å…¨å±€æš´éœ²æ–¹æ³•ï¼Œä¾›å°ç¨‹åºä¾§è°ƒç”¨æµ‹è¯•è„šæœ¬ä¸­çš„æ–¹æ³•ã€‚

```typescript
miniProgram.exposeFunction(name: string, bindingFunction: Function): Promise<void>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| name | string | æ˜¯ | å…¨å±€æ–¹æ³•å |
| bindingFunction | Function | æ˜¯ | è„šæœ¬æ–¹æ³• |

> ğŸ’¡ ä½ å¯ä»¥åˆ©ç”¨è¯¥æ–¹æ³•æ¥ç›‘å¬äº‹ä»¶ï¼Œä¸æ”¯æŒåœ¨å°ç¨‹åºä¾§è·å–è°ƒç”¨ç»“æœã€‚

**ç¤ºä¾‹ä»£ç **

```javascript
await miniProgram.exposeFunction('onAppShow', options => {
  // Do something...
})

await miniProgram.evaluate(function() {
  wx.onAppShow(function(options) {
    onAppShow(options)
  })
})
```

#### 3.6.2 miniProgram.testAccounts

> ğŸ“Œ automator 0.9.0ï¼Œå¼€å‘è€…å·¥å…· 1.02.2002272 å¼€å§‹æ”¯æŒ

è·å–å¤šè´¦å·è°ƒè¯•ä¸­å·²æ·»åŠ çš„ç”¨æˆ·åˆ—è¡¨ã€‚

```typescript
miniProgram.testAccounts(): Promise<Account[]>
```

**Account å­—æ®µ**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| nickName | string | ç”¨æˆ·æ˜µç§° |
| openid | string | è´¦å· openid |

**ç¤ºä¾‹ä»£ç **

```javascript
const testAccounts = await miniProgram.testAccounts()
for (let i = 0, len = testAccounts.length; i < len; i++) {
  const miniProgram = await automator.launch({
    projectPath: 'path/to/project',
    account: testAccounts[i].openid
  })
  // æ§åˆ¶å¤šä¸ªç”¨æˆ·ç™»å½•çš„ä¸åŒå°ç¨‹åº
}
```

#### 3.6.3 miniProgram.stopAudits

> ğŸ“Œ automator 0.10.0ï¼Œå¼€å‘è€…å·¥å…· 1.04.2006242 å¼€å§‹æ”¯æŒ

åœæ­¢ä½“éªŒè¯„åˆ†å¹¶è·å–æŠ¥å‘Šã€‚

```typescript
miniProgram.stopAudits(options?: Object): Promise<Object>
```

**å‚æ•°è¯´æ˜**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| options | Object | å¦ | - | é€‰é¡¹ |

**options å­—æ®µ**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| path | string | å¦ | - | æŠ¥å‘Šä¿å­˜è·¯å¾„ |

> âš ï¸ éœ€è¦å¼€å¯è‡ªåŠ¨è¿è¡Œä½“éªŒè¯„åˆ†é€‰é¡¹

**ç¤ºä¾‹ä»£ç **

```javascript
automator.launch({
  projectConfig: {
    setting: {
      autoAudits: true,
    },
  },
}).then(async miniProgram => {
  const data = await miniProgram.stopAudits({
    path: 'report.html'
  })
  console.log(data) // ä½“éªŒè¯„åˆ†æŠ¥å‘Šæ•°æ®
})
```

### 3.7 ç¥¨æ®ç®¡ç†

#### 3.7.1 miniProgram.getTicket

è·å–å¼€å‘è€…å·¥å…·å½“å‰çš„ç™»å½•ç¥¨æ®ã€‚

> âš ï¸ ç¡®ä¿å·¥å…·å®‰å…¨è®¾ç½®ä¸­å·²å¼€å¯å…è®¸è·å–å·¥å…·ç™»å½•ç¥¨æ®åŠŸèƒ½

```typescript
miniProgram.getTicket(): Promise<Object>
```

**è¿”å›å€¼è¯´æ˜**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| ticket | string | ç™»å½•ç¥¨æ® |
| expiredTime | number | ç¥¨æ®è¿‡æœŸæ—¶é—´ |

**ç¤ºä¾‹ä»£ç **

```javascript
const result = await miniProgram.getTicket()
console.log(result.ticket)
```

#### 3.7.2 miniProgram.setTicket

è®¾ç½®å¼€å‘è€…å·¥å…·ç™»å½•ç¥¨æ®ï¼Œå¯åœ¨å·¥å…·è¿è¡Œæµ‹è¯•æœŸé—´æ›´æ–°å¤±æ•ˆçš„ç™»å½•ç¥¨æ®ã€‚

```typescript
miniProgram.setTicket(ticket: string): Promise<void>
```

**ç¤ºä¾‹ä»£ç **

```javascript
// ticket ä»å·²ç™»å½•çš„å¼€å‘è€…å·¥å…·è·å–
automator.launch({
  ticket,
}).then(async miniProgram => {
  // å¦‚æœåˆå§‹ç¥¨æ®å·²å¤±æ•ˆï¼Œè·å–æ–°ç¥¨æ®åé€šè¿‡ setTicket æ›´æ–°
  await miniProgram.setTicket(ticket)
})
```

#### 3.7.3 miniProgram.refreshTicket

åˆ·æ–°å¼€å‘è€…å·¥å…·ç™»å½•ç¥¨æ®ï¼Œå¯ä»¥ä½¿ç¥¨æ®è¿‡æœŸæ—¶é—´é‡ç½®ä¸ºä¸¤å°æ—¶ã€‚

```typescript
miniProgram.refreshTicket(): Promise<void>
```

> âš ï¸ åˆ·æ–°ç¥¨æ®ååŸæœ‰çš„ç¥¨æ®å³ä½¿è¿‡æœŸæ—¶é—´æœªåˆ°ä¹Ÿä¼šè¿‡æœŸ

**ç¤ºä¾‹ä»£ç **

```javascript
await miniProgram.refreshTicket()
```

### 3.8 çœŸæœºè°ƒè¯•

#### 3.8.1 miniProgram.remote

å¼€å¯å·¥å…·çœŸæœºè°ƒè¯•åŠŸèƒ½ã€‚

```typescript
miniProgram.remote(auto?: boolean): Promise<void>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| auto | boolean | å¦ | false | æ˜¯å¦è‡ªåŠ¨çœŸæœºè°ƒè¯• |

è°ƒç”¨åè„šæœ¬ä¼šå¯åŠ¨å·¥å…·çœŸæœºè°ƒè¯•åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨æ§åˆ¶å°ä¸Šæ‰“å°äºŒç»´ç ï¼Œç„¶åä½ éœ€è¦ä½¿ç”¨çœŸæœºæ‰«ç è¿æ¥ä½¿è‡ªåŠ¨åŒ–è„šæœ¬ç»§ç»­è·‘ä¸‹å»ã€‚

> ğŸ’¡ auto ä¸º true æ—¶ï¼ŒçœŸæœºä¸Šä¼šè‡ªåŠ¨è°ƒèµ·å°ç¨‹åºï¼Œæ— éœ€æ‰«ç ï¼Œä»…æ”¯æŒå¾®ä¿¡ 7.0.6ï¼ˆå®‰å“ï¼‰ã€6.6.7ï¼ˆiOSï¼‰åŠä»¥ä¸Šç‰ˆæœ¬

**ç¤ºä¾‹ä»£ç **

```javascript
await miniProgram.remote()
// æ‰«ç è¿æ¥æˆåŠŸååœ¨çœŸæœºä¸Šæ‰§è¡Œè‡ªåŠ¨åŒ–è„šæœ¬
```

### 3.9 è¿æ¥ç®¡ç†

#### 3.9.1 miniProgram.disconnect

æ–­å¼€ä¸å°ç¨‹åºè¿è¡Œæ—¶çš„è¿æ¥ã€‚

```typescript
miniProgram.disconnect(): void
```

**ç¤ºä¾‹ä»£ç **

```javascript
miniProgram.disconnect()
```

#### 3.9.2 miniProgram.close

æ–­å¼€ä¸å°ç¨‹åºè¿è¡Œæ—¶çš„è¿æ¥å¹¶å…³é—­é¡¹ç›®çª—å£ã€‚

```typescript
miniProgram.close(): Promise<void>
```

**ç¤ºä¾‹ä»£ç **

```javascript
await miniProgram.close()
```

### 3.10 äº‹ä»¶ç›‘å¬

#### 3.10.1 console

æ—¥å¿—æ‰“å°æ—¶è§¦å‘ã€‚

**msg å‚æ•°å­—æ®µ**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| type | string | æ—¥å¿—ç±»å‹ï¼Œlogã€info ç­‰ |
| args | array\<any\> | æ—¥å¿—å†…å®¹ |

**ç¤ºä¾‹ä»£ç **

```javascript
miniProgram.on('console', msg => {
  console.log(msg.type, msg.args)
})
```

#### 3.10.2 exception

é¡µé¢ JS å‡ºé”™æ—¶è§¦å‘ã€‚

**error å‚æ•°å­—æ®µ**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| message | string | é”™è¯¯ä¿¡æ¯ |
| stack | string | é”™è¯¯å †æ ˆ |

**ç¤ºä¾‹ä»£ç **

```javascript
miniProgram.on('exception', err => {
  console.log(err.message, err.stack)
})
```

---

## 4. Page API

Page æ¨¡å—æä¾›äº†æ§åˆ¶å°ç¨‹åºé¡µé¢çš„æ–¹æ³•ã€‚

### 4.1 å±æ€§

#### 4.1.1 page.path

é¡µé¢è·¯å¾„ã€‚

```typescript
page.path: string
```

#### 4.1.2 page.query

é¡µé¢å‚æ•°ã€‚

```typescript
page.query: Object
```

### 4.2 å…ƒç´ é€‰æ‹©æ–¹æ³•

#### 4.2.1 page.$

è·å–é¡µé¢å…ƒç´ ã€‚

```typescript
page.$(selector: string): Promise<Element>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| selector | string | æ˜¯ | é€‰æ‹©å™¨ |

> ğŸ’¡ åŒ WXSSï¼Œä»…æ”¯æŒéƒ¨åˆ† CSS é€‰æ‹©å™¨

**ç¤ºä¾‹ä»£ç **

```javascript
const page = await miniProgram.currentPage()
const element = await page.$('.index-desc')
console.log(element.tagName) // -> 'view'
```

#### 4.2.2 page.$$

è·å–é¡µé¢å…ƒç´ æ•°ç»„ã€‚

```typescript
page.$$(selector: string): Promise<Element[]>
```

> âš ï¸ è¯¥æ–¹æ³•è·Ÿ $ ä¸€æ ·å‡æ— æ³•é€‰æ‹©è‡ªå®šä¹‰ç»„ä»¶å†…çš„å…ƒç´ ï¼Œè¯·ä½¿ç”¨ `element.$`

**ç¤ºä¾‹ä»£ç **

```javascript
const elements = await page.$$('.kind-list-text')
console.log(elements.length)
```

### 4.3 ç­‰å¾…æ–¹æ³•

#### 4.3.1 page.waitFor

ç­‰å¾…ç›´åˆ°æŒ‡å®šæ¡ä»¶æˆç«‹ã€‚

```typescript
page.waitFor(condition: string | number | Function): Promise<void>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| condition | string \| number \| Function | æ˜¯ | ç­‰å¾…æ¡ä»¶ |

**æ¡ä»¶ç±»å‹è¯´æ˜**

- **string ç±»å‹**: å½“æˆé€‰æ‹©å™¨ï¼Œå½“è¯¥é€‰æ‹©å™¨é€‰ä¸­å…ƒç´ ä¸ªæ•°ä¸ä¸ºé›¶æ—¶ï¼Œç»“æŸç­‰å¾…
- **number ç±»å‹**: å½“æˆè¶…æ—¶æ—¶é•¿ï¼Œå½“ç»è¿‡æŒ‡å®šæ—¶é—´åï¼Œç»“æŸç­‰å¾…
- **Function ç±»å‹**: å½“æˆæ–­è¨€å‡½æ•°ï¼Œå½“è¯¥å‡½æ•°è¿”å›çœŸå€¼æ—¶ï¼Œç»“æŸç­‰å¾…

**ç¤ºä¾‹ä»£ç **

```javascript
await page.waitFor(5000) // ç­‰å¾… 5 ç§’
await page.waitFor('picker') // ç­‰å¾…é¡µé¢ä¸­å‡ºç° picker å…ƒç´ 
await page.waitFor(async () => {
  return (await page.$$('picker')).length > 5
}) // ç­‰å¾…é¡µé¢ä¸­ picker å…ƒç´ æ•°é‡å¤§äº 5
```

### 4.4 æ•°æ®æ“ä½œæ–¹æ³•

#### 4.4.1 page.data

> ğŸ“Œ ä¼ é€’æ•°æ®è·¯å¾„ automator 0.6.0ï¼ŒåŸºç¡€åº“ 2.9.0 å¼€å§‹æ”¯æŒ

è·å–é¡µé¢æ¸²æŸ“æ•°æ®ã€‚

```typescript
page.data(path?: string): Promise<Object>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| path | string | å¦ | æ•°æ®è·¯å¾„ |

**ç¤ºä¾‹ä»£ç **

```javascript
console.log(await page.data('list'))
```

#### 4.4.2 page.setData

è®¾ç½®é¡µé¢æ¸²æŸ“æ•°æ®ã€‚

```typescript
page.setData(data: Object): Promise<void>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| data | Object | æ˜¯ | è¦æ”¹å˜çš„æ•°æ® |

**ç¤ºä¾‹ä»£ç **

```javascript
await page.setData({
  text: 'changed data'
})
```

### 4.5 é¡µé¢ä¿¡æ¯æ–¹æ³•

#### 4.5.1 page.size

è·å–é¡µé¢å¤§å°ã€‚

```typescript
page.size(): Promise<Object>
```

**è¿”å›å€¼è¯´æ˜**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| width | number | é¡µé¢å¯æ»šåŠ¨å®½åº¦ |
| height | number | é¡µé¢å¯æ»šåŠ¨é«˜åº¦ |

**ç¤ºä¾‹ä»£ç **

```javascript
const { width, height } = await page.size()
console.log(width, height)
```

#### 4.5.2 page.scrollTop

> ğŸ“Œ automator 0.7.0 å¼€å§‹æ”¯æŒ

è·å–é¡µé¢æ»šåŠ¨ä½ç½®ã€‚

```typescript
page.scrollTop(): Promise<number>
```

**ç¤ºä¾‹ä»£ç **

```javascript
await miniProgram.pageScrollTo(20)
console.log(await page.scrollTop())
```

### 4.6 æ–¹æ³•è°ƒç”¨

#### 4.6.1 page.callMethod

è°ƒç”¨é¡µé¢æŒ‡å®šæ–¹æ³•ã€‚

```typescript
page.callMethod(method: string, ...args: any[]): Promise<any>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| method | string | æ˜¯ | éœ€è¦è°ƒç”¨çš„æ–¹æ³•å |
| ...args | array\<any\> | å¦ | æ–¹æ³•å‚æ•° |

**ç¤ºä¾‹ä»£ç **

```javascript
await page.callMethod('onShareAppMessage')
```

---

## 5. Element API

Element æ¨¡å—æä¾›äº†æ§åˆ¶å°ç¨‹åºé¡µé¢å…ƒç´ çš„æ–¹æ³•ã€‚

### 5.1 å±æ€§

#### 5.1.1 element.tagName

æ ‡ç­¾åï¼Œå°å†™ã€‚

```typescript
element.tagName: string
```

### 5.2 å…ƒç´ æŸ¥è¯¢æ–¹æ³•

#### 5.2.1 element.$

åœ¨å…ƒç´ èŒƒå›´å†…è·å–å…ƒç´ ã€‚

```typescript
element.$(selector: string): Promise<Element>
```

**ç¤ºä¾‹ä»£ç **

```javascript
let element = await page.$('.index-hd')
element = await element.$('.index-desc')
console.log(await element.text())
```

#### 5.2.2 element.$$

åœ¨å…ƒç´ èŒƒå›´å†…è·å–å…ƒç´ æ•°ç»„ã€‚

```typescript
element.$$(selector: string): Promise<Element[]>
```

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('.index-bd')
const elements = await element.$$('.kind-list-text')
console.log(await elements[0].text())
```

### 5.3 å…ƒç´ ä¿¡æ¯æ–¹æ³•

#### 5.3.1 element.size

è·å–å…ƒç´ å¤§å°ã€‚

```typescript
element.size(): Promise<Object>
```

**è¿”å›å€¼è¯´æ˜**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| width | number | å…ƒç´ å®½åº¦ |
| height | number | å…ƒç´ é«˜åº¦ |

**ç¤ºä¾‹ä»£ç **

```javascript
const { width, height } = await element.size()
console.log(width, height)
```

#### 5.3.2 element.offset

è·å–å…ƒç´ ç»å¯¹ä½ç½®ã€‚

```typescript
element.offset(): Promise<Object>
```

**è¿”å›å€¼è¯´æ˜**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| left | number | å·¦ä¸Šè§’ x åæ ‡ï¼Œå•ä½ï¼špx |
| top | number | å·¦ä¸Šè§’ y åæ ‡ï¼Œå•ä½ï¼špx |

> ğŸ’¡ åæ ‡ä¿¡æ¯ä»¥é¡µé¢å·¦ä¸Šè§’ä¸ºåŸç‚¹

**ç¤ºä¾‹ä»£ç **

```javascript
const { left, top } = await element.offset()
console.log(left, top)
```

#### 5.3.3 element.text

è·å–å…ƒç´ æ–‡æœ¬ã€‚

```typescript
element.text(): Promise<string>
```

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('.index-desc')
console.log(await element.text())
```

### 5.4 å±æ€§ä¸æ ·å¼æ–¹æ³•

#### 5.4.1 element.attribute

è·å–å…ƒç´ ç‰¹æ€§ã€‚

```typescript
element.attribute(name: string): Promise<string>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| name | string | æ˜¯ | ç‰¹æ€§å |

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('.index-logo')
console.log(await element.attribute('src')) // -> 'resources/kind/logo.png'
```

#### 5.4.2 element.property

> ğŸ“Œ automator 0.9.0ï¼ŒåŸºç¡€åº“ 2.9.5 å¼€å§‹æ”¯æŒ

è·å–å…ƒç´ å±æ€§ã€‚

```typescript
element.property(name: string): Promise<any>
```

**element.property ä¸ element.attribute ä¸»è¦åŒºåˆ«**

- `element.attribute` è·å–çš„æ˜¯æ ‡ç­¾ä¸Šçš„å€¼ï¼Œå› æ­¤å®ƒçš„è¿”å›ç±»å‹ä¸€å®šæ˜¯å­—ç¬¦ä¸²ï¼Œ`element.property` åˆ™ä¸ä¸€å®š
- `element.attribute` å¯ä»¥è·å–åˆ° class å’Œ id ä¹‹ç±»çš„å€¼ï¼Œ`element.property` ä¸è¡Œ
- `element.property` å¯ä»¥è·å–åˆ°æ–‡æ¡£é‡Œå¯¹åº”ç»„ä»¶åˆ—ä¸¾çš„å¤§éƒ¨åˆ†å±æ€§å€¼ï¼Œæ¯”å¦‚è¡¨å• input ç­‰ç»„ä»¶çš„ value å€¼

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('input')
console.log(await element.property('value'))
```

#### 5.4.3 element.wxml

è·å–å…ƒç´  WXMLã€‚

```typescript
element.wxml(): Promise<string>
```

#### 5.4.4 element.outerWxml

åŒ wxmlï¼Œåªæ˜¯ä¼šè·å–åˆ°å…ƒç´ æœ¬èº«ã€‚

```typescript
element.outerWxml(): Promise<string>
```

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('.index-desc')
console.log(await element.wxml())
console.log(await element.outerWxml())
```

#### 5.4.5 element.value

è·å–å…ƒç´ å€¼ã€‚

```typescript
element.value(): Promise<string>
```

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('.weui-input')
console.log(await element.value())
```

#### 5.4.6 element.style

è·å–å…ƒç´ æ ·å¼å€¼ã€‚

```typescript
element.style(name: string): Promise<string>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| name | string | æ˜¯ | æ ·å¼å |

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('.index-desc')
console.log(await element.style('color')) // -> 'rgb(136, 136, 136)'
```

### 5.5 äº¤äº’æ“ä½œæ–¹æ³•

#### 5.5.1 element.tap

ç‚¹å‡»å…ƒç´ ã€‚

```typescript
element.tap(): Promise<void>
```

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('.kind-list-item-hd')
await element.tap()
```

#### 5.5.2 element.longpress

é•¿æŒ‰å…ƒç´ ã€‚

```typescript
element.longpress(): Promise<void>
```

#### 5.5.3 element.touchstart

> ğŸ“Œ automator 0.8.0ï¼ŒåŸºç¡€åº“ 2.9.1 å¼€å§‹æ”¯æŒ

æ‰‹æŒ‡å¼€å§‹è§¦æ‘¸å…ƒç´ ã€‚

```typescript
element.touchstart(options: Object): Promise<void>
```

**options å­—æ®µ**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| touches | array\<Touch\> | æ˜¯ | è§¦æ‘¸äº‹ä»¶ï¼Œå½“å‰åœç•™åœ¨å±å¹•ä¸­çš„è§¦æ‘¸ç‚¹ä¿¡æ¯çš„æ•°ç»„ |
| changedTouches | array\<Touch\> | æ˜¯ | è§¦æ‘¸äº‹ä»¶ï¼Œå½“å‰å˜åŒ–çš„è§¦æ‘¸ç‚¹ä¿¡æ¯çš„æ•°ç»„ |

#### 5.5.4 element.touchmove

> ğŸ“Œ automator 0.8.0ï¼ŒåŸºç¡€åº“ 2.9.1 å¼€å§‹æ”¯æŒ

æ‰‹æŒ‡è§¦æ‘¸å…ƒç´ åç§»åŠ¨ã€‚

```typescript
element.touchmove(options: Object): Promise<void>
```

> ğŸ’¡ options å­—æ®µåŒ touchstart

#### 5.5.5 element.touchend

> ğŸ“Œ automator 0.8.0ï¼ŒåŸºç¡€åº“ 2.9.1 å¼€å§‹æ”¯æŒ

æ‰‹æŒ‡ç»“æŸè§¦æ‘¸å…ƒç´ ã€‚

```typescript
element.touchend(options: Object): Promise<void>
```

> ğŸ’¡ options å­—æ®µåŒ touchstart

**ç»¼åˆç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('.touch')

await element.touchstart({
  touches: [{
    identifier: 1,
    pageX: 500,
    pageY: 500
  }],
  changedTouches: [{
    identifier: 1,
    pageX: 500,
    pageY: 500
  }]
})

await element.touchend({
  touches: [],
  changedTouches: [{
    identifier: 1,
    pageX: 500,
    pageY: 500
  }]
})
```

#### 5.5.6 element.trigger

è§¦å‘å…ƒç´ äº‹ä»¶ã€‚

```typescript
element.trigger(type: string, detail?: Object): Promise<void>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| type | string | æ˜¯ | è§¦å‘äº‹ä»¶ç±»å‹ |
| detail | Object | å¦ | è§¦å‘äº‹ä»¶æ—¶ä¼ é€’çš„ detail å€¼ |

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('picker')
await element.trigger('change', { value: 1 })
```

> âš ï¸ è¯¥æ–¹æ³•æ— æ³•æ”¹å˜ç»„ä»¶çŠ¶æ€ï¼Œä»…è§¦å‘å“åº”æ–¹æ³•ï¼Œä¹Ÿæ— æ³•è§¦å‘ç”¨æˆ·æ“ä½œäº‹ä»¶ï¼Œå³ tapï¼Œlongpress ç­‰äº‹ä»¶ï¼Œè¯·ä½¿ç”¨å¯¹åº”çš„å…¶å®ƒæ–¹æ³•è°ƒç”¨

#### 5.5.7 element.input

> ğŸ“Œ automator 0.9.0ï¼ŒåŸºç¡€åº“ 2.9.5 å¼€å§‹æ”¯æŒ

è¾“å…¥æ–‡æœ¬ï¼Œä»… inputã€textarea ç»„ä»¶å¯ä»¥ä½¿ç”¨ã€‚

```typescript
element.input(value: string): Promise<void>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| value | string | æ˜¯ | éœ€è¦è¾“å…¥çš„æ–‡æœ¬ |

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('input')
await element.input('test')
```

### 5.6 ç»„ä»¶æ–¹æ³•

#### 5.6.1 element.callMethod

> ğŸ“Œ automator 0.6.0ï¼ŒåŸºç¡€åº“ 2.9.0 å¼€å§‹æ”¯æŒ

è°ƒç”¨ç»„ä»¶å®ä¾‹æŒ‡å®šæ–¹æ³•ï¼Œä»…è‡ªå®šä¹‰ç»„ä»¶å¯ä»¥ä½¿ç”¨ã€‚

```typescript
element.callMethod(method: string, ...args: any[]): Promise<any>
```

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('set-tab-bar')
await element.callMethod('navigateBack')
```

#### 5.6.2 element.data

> ğŸ“Œ automator 0.6.0ï¼ŒåŸºç¡€åº“ 2.9.0 å¼€å§‹æ”¯æŒ

è·å–ç»„ä»¶å®ä¾‹æ¸²æŸ“æ•°æ®ï¼Œä»…è‡ªå®šä¹‰ç»„ä»¶å¯ä»¥ä½¿ç”¨ã€‚

```typescript
element.data(path?: string): Promise<Object>
```

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('set-tab-bar')
console.log(await element.data('hasSetTabBarBadge'))
```

#### 5.6.3 element.setData

> ğŸ“Œ automator 0.6.0ï¼ŒåŸºç¡€åº“ 2.9.0 å¼€å§‹æ”¯æŒ

è®¾ç½®ç»„ä»¶å®ä¾‹æ¸²æŸ“æ•°æ®ï¼Œä»…è‡ªå®šä¹‰ç»„ä»¶å¯ä»¥ä½¿ç”¨ã€‚

```typescript
element.setData(data: Object): Promise<void>
```

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('set-tab-bar')
await element.setData({
  hasSetTabBarBadge: true
})
```

#### 5.6.4 element.callContextMethod

> ğŸ“Œ automator 0.9.0ï¼ŒåŸºç¡€åº“ 2.9.5 å¼€å§‹æ”¯æŒ

è°ƒç”¨ä¸Šä¸‹æ–‡ Context å¯¹è±¡æ–¹æ³•ï¼Œä»… video ç»„ä»¶å¯ä»¥ä½¿ç”¨ã€‚

```typescript
element.callContextMethod(method: string, ...args: any[]): Promise<any>
```

> âš ï¸ video ç»„ä»¶å¿…é¡»è®¾ç½®äº† id æ‰èƒ½ä½¿ç”¨

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('video')
await element.callContextMethod('play')
```

### 5.7 æ»šåŠ¨è§†å›¾æ–¹æ³•

#### 5.7.1 element.scrollWidth

> ğŸ“Œ automator 0.9.0ï¼ŒåŸºç¡€åº“ 2.9.5 å¼€å§‹æ”¯æŒ

è·å–æ»šåŠ¨å®½åº¦ï¼Œä»… scroll-view ç»„ä»¶å¯ä»¥ä½¿ç”¨ã€‚

```typescript
element.scrollWidth(): Promise<number>
```

#### 5.7.2 element.scrollHeight

> ğŸ“Œ automator 0.9.0ï¼ŒåŸºç¡€åº“ 2.9.5 å¼€å§‹æ”¯æŒ

è·å–æ»šåŠ¨é«˜åº¦ï¼Œä»… scroll-view ç»„ä»¶å¯ä»¥ä½¿ç”¨ã€‚

```typescript
element.scrollHeight(): Promise<number>
```

#### 5.7.3 element.scrollTo

> ğŸ“Œ automator 0.9.0ï¼ŒåŸºç¡€åº“ 2.9.5 å¼€å§‹æ”¯æŒ

æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®ï¼Œä»… scroll-view ç»„ä»¶å¯ä»¥ä½¿ç”¨ã€‚

```typescript
element.scrollTo(x: number, y: number): Promise<void>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| x | number | æ˜¯ | æ¨ªå‘æ»šåŠ¨ä½ç½® |
| y | number | æ˜¯ | çºµå‘æ»šåŠ¨ä½ç½® |

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('scroll-view')
const y = (await element.scrollHeight()) - 50
await element.scrollTo(0, y)
```

### 5.8 å…¶ä»–ç»„ä»¶ä¸“ç”¨æ–¹æ³•

#### 5.8.1 element.swipeTo

> ğŸ“Œ automator 0.9.0ï¼ŒåŸºç¡€åº“ 2.9.5 å¼€å§‹æ”¯æŒ

æ»‘åŠ¨åˆ°æŒ‡å®šæ»‘å—ï¼Œä»… swiper ç»„ä»¶å¯ä»¥ä½¿ç”¨ã€‚

```typescript
element.swipeTo(index: number): Promise<void>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| index | number | æ˜¯ | ç›®æ ‡æ»‘å—çš„ index |

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('swiper')
await element.swipeTo(2)
```

#### 5.8.2 element.moveTo

> ğŸ“Œ automator 0.9.0ï¼ŒåŸºç¡€åº“ 2.9.5 å¼€å§‹æ”¯æŒ

ç§»åŠ¨è§†å›¾å®¹å™¨ï¼Œä»… movable-view ç»„ä»¶å¯ä»¥ä½¿ç”¨ã€‚

```typescript
element.moveTo(x: number, y: number): Promise<void>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| x | number | æ˜¯ | x è½´æ–¹å‘çš„åç§» |
| y | number | æ˜¯ | y è½´æ–¹å‘çš„åç§» |

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('movable-view')
await element.moveTo(40, 40)
```

#### 5.8.3 element.slideTo

> ğŸ“Œ automator 0.9.0ï¼ŒåŸºç¡€åº“ 2.9.5 å¼€å§‹æ”¯æŒ

æ»‘åŠ¨åˆ°æŒ‡å®šæ•°å€¼ï¼Œä»… slider ç»„ä»¶å¯ä»¥ä½¿ç”¨ã€‚

```typescript
element.slideTo(value: number): Promise<void>
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| value | number | æ˜¯ | è¦è®¾ç½®çš„å€¼ |

**ç¤ºä¾‹ä»£ç **

```javascript
const element = await page.$('slider')
await element.slideTo(10)
```

---

## 6. å¸¸ç”¨ç¤ºä¾‹

è¿™é‡Œæä¾›ä¸€äº›å¸¸ç”¨çš„æµ‹è¯•æ–¹æ³•ç¤ºä¾‹ï¼Œä»¥å¸®åŠ©ä½ æ›´å¥½åœ°å»ä½¿ç”¨è‡ªåŠ¨åŒ– SDK å®Œæˆæµ‹è¯•ä»»åŠ¡ã€‚

### 6.1 é”™è¯¯å¤„ç†

SDK çš„æ–¹æ³•è°ƒç”¨æœ‰å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯ï¼Œæ¯”å¦‚ `miniProgram.navigateTo('path/to/page')` åœ¨é¡µé¢ä¸å­˜åœ¨æ—¶ä¼šå‡ºé”™ã€‚

åœ¨å¯èƒ½å‡ºé”™çš„ä»£ç ä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨ `try catch` è¿›è¡Œå¤„ç†ï¼š

```javascript
automator.launch().then(async miniProgram => {
  let page
  try {
    page = await miniProgram.navigateTo('/page/component/index')
  } catch (e) {
    // å¤„ç†å‡ºé”™æƒ…å†µ
    console.log(e.message)
  }
})
```

### 6.2 æ¨¡æ¿æµ‹è¯•

å°ç¨‹åºçš„æ¨¡æ¿æ˜¯ç”± WXML æ ‡è®°è¯­è¨€ç¼–å†™çš„ã€‚åœ¨æ‰§è¡Œæ—¶ï¼Œå°ç¨‹åºä¼šå°†æ¨¡æ¿å’Œé¡µé¢æ•°æ®ç›¸ç»“åˆæ¸²æŸ“å‡ºæœ€ç»ˆçš„é¡µé¢æ¥ã€‚æµ‹è¯•æ¡†æ¶ Jest æä¾›äº†ä¸€é¡¹å¾ˆæ£’çš„**å¿«ç…§**åŠŸèƒ½ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å’Œ SDK æä¾›çš„è®¾ç½®é¡µé¢æ•°æ®æ¥å£ï¼Œä½ å¯ä»¥å¾ˆè½»æ¾åœ°æµ‹è¯•æ¨¡æ¿æ–‡ä»¶åœ¨ä¸åŒæ•°æ®ä¸‹æ¸²æŸ“å‡ºæ¥çš„ç»“æœæ˜¯å¦æ­£ç¡®ã€‚

ä¸‹é¢æ˜¯å°ç¨‹åºç¤ºä¾‹æµ‹è¯•æ¥å£é¡µæ¨¡æ¿çš„ä»£ç ç¤ºä¾‹ï¼š

```javascript
const automator = require('miniprogram-automator')

describe('api', () => {
  let miniProgram
  let page

  beforeAll(async () => {
    miniProgram = await automator.launch({
      projectPath: 'path/to/miniprogram-demo'
    })
    page = await miniProgram.reLaunch('/page/API/index')
    await page.waitFor(500)
  })

  afterAll(async () => {
    await miniProgram.close()
  })

  it('wxml', async () => {
    const element = await page.$('page')
    expect(await element.wxml()).toMatchSnapshot()
    await page.setData({
      list: []
    })
    expect(await element.wxml()).toMatchSnapshot()
  })
})
```

### 6.3 æµ‹è¯•ç¯å¢ƒ

åœ¨æµ‹è¯•æ—¶ï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½éœ€è¦æ‰§è¡Œä¸€äº›ç‰¹æ®Šé€»è¾‘ï¼Œæ¯”å¦‚ä½¿ç”¨æµ‹è¯•è´¦å·ï¼Œæˆ–è€…ä½¿ç”¨ä¸åŒçš„è¯·æ±‚åœ°å€ã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬å»ºè®®åœ¨å°ç¨‹åºä»£ç ä¸­æ¤å…¥è¿™éƒ¨åˆ†ä»£ç ï¼Œç„¶ååœ¨å…¨å±€å¯¹è±¡ globalData ä¸Šè®¾ç½®å¼€å…³ï¼Œé€šè¿‡ SDK æä¾›çš„æ‰§è¡Œä»£ç ç‰‡æ®µåŠŸèƒ½åœ¨æµ‹è¯•æ—¶å¼€å¯ã€‚

ä¸‹é¢æ˜¯å°ç¨‹åºç¤ºä¾‹æµ‹è¯•ç™»å½•æ¥å£é¡µæ¨¡æ¿çš„ä»£ç ç¤ºä¾‹ï¼š

```javascript
const automator = require('miniprogram-automator')

describe('api', () => {
  let miniProgram
  let page

  beforeAll(async () => {
    miniProgram = await automator.launch({
      projectPath: 'path/to/miniprogram-demo'
    })
    // ç›´æ¥æ›´æ”¹å…¨å±€å˜é‡
    await miniProgram.evaluate(() => {
      getApp().globalData.hasLogin = true
    })
    page = await miniProgram.reLaunch('/page/API/pages/login/login')
    await page.waitFor(500)
  })

  afterAll(async () => {
    await miniProgram.close()
  })

  it('wxml', async () => {
    const element = await page.$('page')
    expect(await element.wxml()).toMatchSnapshot()
  })
})
```

### 6.4 ä¼ªé€ è¯·æ±‚ç»“æœ

åœ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼Œæœ‰æ—¶ä¸ºäº†æ¨¡æ‹Ÿå„ç§æƒ…å†µï¼Œéœ€è¦å¯¹ wx æ–¹æ³•è°ƒç”¨çš„ç»“æœè¿›è¡Œä¼ªé€ ï¼Œæ¯”å¦‚ä¼ªé€ åœ°ç†ä½ç½®ã€ä¼ªé€ è¯·æ±‚ç»“æœç­‰ï¼Œè¿™ç§æƒ…å†µä¸‹å°±å¯ä»¥ä½¿ç”¨ `miniProgram.mockWxMethod`ã€‚

ä¸‹é¢æ˜¯ä¼ªé€ ç‰¹å®šè¯·æ±‚ç»“æœçš„ä»£ç ç¤ºä¾‹ï¼š

```javascript
const automator = require('miniprogram-automator')

describe('api', () => {
  let miniProgram

  beforeAll(async () => {
    miniProgram = await automator.launch({
      projectPath: 'path/to/miniprogram-demo'
    })
  })

  afterAll(async () => {
    await miniProgram.close()
  })

  it('request', async () => {
    const mockData = [
      {
        rule: 'testRequest',
        result: {
          data: 'test',
          cookies: [],
          header: {},
          statusCode: 200,
        },
      },
    ]

    await miniProgram.mockWxMethod(
      'request',
      function(obj, data) {
        for (let i = 0, len = data.length; i < len; i++) {
          const item = data[i]
          const rule = new RegExp(item.rule)
          if (rule.test(obj.url)) {
            return item.result
          }

          // æ²¡å‘½ä¸­è§„åˆ™çš„çœŸå®è®¿é—®åå°
          return new Promise(resolve => {
            obj.success = res => resolve(res)
            obj.fail = res => resolve(res)
            this.origin(obj)
          })
        }
      },
      mockData,
    )

    const result = await miniProgram.callWxMethod('request', {
      url: 'https://14592619.qcloud.la/testRequest',
    })
    console.log(result.data) // -> 'test'
    await miniProgram.restoreWxMethod('request')
  })
})
```

---

## 7. çœŸæœºè‡ªåŠ¨åŒ–

å°ç¨‹åºè‡ªåŠ¨åŒ–é™¤äº†èƒ½å¤Ÿæ§åˆ¶å¼€å‘è€…å·¥å…·ä¸­çš„å°ç¨‹åºæ¨¡æ‹Ÿå™¨ï¼Œä¹Ÿæ”¯æŒé€šè¿‡è¿œç¨‹è°ƒè¯•æ§åˆ¶çœŸæœºï¼Œä»¥è¾¾åˆ°åœ¨çœŸæœºä¸Šè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„ç›®çš„ã€‚

### 7.1 è¿è¡Œç¯å¢ƒ

- ç¡®ä¿ç›®æ ‡æœºå™¨ä¸Šçš„åŸºç¡€åº“ç‰ˆæœ¬ä¸º `2.7.3` åŠä»¥ä¸Š

### 7.2 ä½¿ç”¨æ–¹å¼

åœ¨ç¼–å†™å®Œæµ‹è¯•ç”¨ä¾‹å¹¶ä¸”åœ¨å·¥å…·æ¨¡æ‹Ÿå™¨ä¸Šæµ‹è¯•æˆåŠŸä¹‹åï¼Œå‡å¦‚æƒ³è¦åœ¨çœŸæœºä¸Šè·‘è‡ªåŠ¨åŒ–ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹æ³•å®ç°ã€‚

#### 7.2.1 é€šè¿‡ SDK å¯åŠ¨

ä½ å¯ä»¥åœ¨æµ‹è¯•è„šæœ¬å¼€å¤´ä½¿ç”¨ `miniProgram.remote` æ¥å£å¯åŠ¨å·¥å…·çš„çœŸæœºè°ƒè¯•åŠŸèƒ½ï¼Œè°ƒç”¨æˆåŠŸåè„šæœ¬ä¼šåœ¨æ§åˆ¶å°æ‰“å°äºŒç»´ç ã€‚ä½¿ç”¨ç›®æ ‡æœºå™¨æ‰«ç æˆåŠŸè¿æ¥åï¼Œè„šæœ¬ä¼šç»§ç»­åœ¨çœŸæœºä¸Šæ‰§è¡Œä¸‹å»ã€‚

**è„šæœ¬ç¤ºä¾‹**

```javascript
const automator = require('miniprogram-automator')

automator.launch({
  cliPath: 'path/to/cli',
  projectPath: 'path/to/project',
}).then(async miniProgram => {
  await miniProgram.remote() // æ‰«ç ç™»å½•è¿æ¥çœŸæœºï¼Œåœ¨çœŸæœºä¸Šæ‰§è¡Œåç»­æµ‹è¯•è„šæœ¬
  const page = await miniProgram.reLaunch('/page/component/index')
  await page.waitFor(500)
  const element = await page.$('.kind-list-item-hd')
  console.log(await element.attribute('class'))
  await element.tap()
  await miniProgram.close()
})
```

#### 7.2.2 æ‰‹å·¥å¯åŠ¨

å¦‚æœå·¥å…·æ˜¯æ‰“å¼€å¸¸é©»å¹¶ä¸”ä½¿ç”¨ `automator.connect` æ¥å£è¿›è¡Œè¿æ¥ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆæ‰‹å·¥å¯ç”¨å·¥å…·çš„çœŸæœºè°ƒè¯•åŠŸèƒ½åå†è¿è¡Œæµ‹è¯•è„šæœ¬ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨çœŸæœºä¸Šæµ‹è¯•å°ç¨‹åºäº†ã€‚

---

## 8. å½•åˆ¶å›æ”¾

å¼€å‘è€…å¯ä»¥å°†æµ‹è¯•æ“ä½œæå‰å½•åˆ¶å¥½ï¼Œç„¶åé€šè¿‡æ‰§è¡Œå½•åˆ¶è„šæœ¬æ¥å®ç°æµ‹è¯•è¿‡ç¨‹çš„å›æ”¾ã€‚

### 8.1 è¿è¡Œç¯å¢ƒè¦æ±‚

- ä¸‹è½½å¹¶å®‰è£… `1.05.2110202` æˆ–ä»¥ä¸Šç‰ˆæœ¬çš„å¼€å‘è€…å·¥å…·
- åŸºç¡€åº“ç‰ˆæœ¬ä¸º `2.19.6` åŠä»¥ä¸Š

### 8.2 ä½¿ç”¨æµç¨‹

#### 8.2.1 å·¥å…· -> è‡ªåŠ¨åŒ–æµ‹è¯•

é€šè¿‡å·¥å…·èœå•æ‰“å¼€è‡ªåŠ¨åŒ–æµ‹è¯•çª—å£ã€‚

#### 8.2.2 æ–°å»ºç”¨ä¾‹å¹¶å¼€å§‹å½•åˆ¶

æ–°å»ºä¼šå¼¹å‡ºä¸€ä¸ªæ–°å»ºå¼¹çª—ï¼Œå…è®¸ï¼š

- ä¿®æ”¹ç”¨ä¾‹å
- é€‰æ‹©æ˜¯å¦å¼€å¯ mock
- ä¿®æ”¹å½•åˆ¶æ—¶çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆé»˜è®¤å€¼ä¸º 10sï¼‰
- é…ç½®è§„åˆ™å¿½ç•¥éšæœºç”Ÿæˆçš„ classname
- é…ç½®æ¸…é™¤ç¼“å­˜é€‰é¡¹

å¼€å§‹å½•åˆ¶åï¼Œæ­£å¸¸ç‚¹å‡»å°ç¨‹åºå…ƒç´ å¯è¿›è¡Œå½•åˆ¶ï¼Œå½•åˆ¶ç»“æŸåå¯ä»¥å†å¾®è°ƒç­‰å¾…æ—¶é—´ç­‰ã€‚

#### 8.2.3 CGI Mock

æ”¯æŒ mock `wx.request`/`wx.cloud.callFunction` ç­‰æ¥å£ã€‚

> ğŸ’¡ äº‘å¼€å‘ç›¸å…³çš„æ¥å£æ”¯æŒçš„æœ€ä½å·¥å…·ç‰ˆæœ¬æ˜¯ `1.06.2206242`

#### 8.2.4 æ–­è¨€/æ£€æŸ¥

å½•åˆ¶æ—¶å¯ä»¥è®°å½• data å¿«ç…§/wxml å¿«ç…§ï¼Œç”¨äºå›æ”¾æ—¶åŒ¹é…æ ¡éªŒï¼Œæˆ–è€…é€‰æ‹©æ£€æŸ¥å…ƒç´ ï¼Œæ–­è¨€å…ƒç´ å­˜åœ¨/innertext æ˜¯å¦ç›¸ç­‰ã€‚

**æ”¯æŒçš„æ–­è¨€ç±»å‹ï¼š**

1. **data å¿«ç…§**: è®°å½•å½“å‰ `page.data` æ•°æ®ï¼Œå›æ”¾æ—¶è¿›è¡ŒåŒ¹é…
2. **wxml å¿«ç…§**: è®°å½• wxml å­—ç¬¦ä¸²
3. **æ£€æŸ¥å…ƒç´ **: æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨æˆ–æ–‡æœ¬å†…å®¹
4. **æˆªå±** (å·¥å…·æœ€ä½å¯ç”¨ç‰ˆæœ¬ `1.06.2206090`): ä»¥ base64 æ ¼å¼å­˜å‚¨æˆªå±ç»“æœ

#### 8.2.5 é‡æ–°å½•åˆ¶

é‡æ–°å½•åˆ¶ä¼šè¦†ç›–ä¹‹å‰å½•åˆ¶çš„ç”¨ä¾‹æ­¥éª¤ã€‚

#### 8.2.6 å›æ”¾

ç‚¹å‡»å›æ”¾å¯è¿›è¡Œå›æ”¾æ“ä½œï¼Œå¤±è´¥ä¼šæ ‡æ³¨å¤±è´¥åŸå› ã€‚å¦å¤–ï¼Œæ”¯æŒæ‰«ç ååœ¨çœŸæœºå›æ”¾ç”¨ä¾‹ã€‚

#### 8.2.7 å›æ”¾å…¨éƒ¨

é€‰æ‹©å›æ”¾å…¨éƒ¨ï¼Œä¼šç”Ÿæˆä¸€ä¸ªç®€æ˜“æµ‹è¯•æŠ¥å‘Šï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ°ã€‚

ä¹Ÿå¯é€‰æ‹©ä½¿ç”¨å·¥å…·å‘½ä»¤è¡Œå›æ”¾ï¼š

```bash
# æ‰“å¼€è‡ªåŠ¨åŒ–æµ‹è¯•çª—å£
cli auto-replay --project /Users/username/demo

# æ‰“å¼€è‡ªåŠ¨åŒ–æµ‹è¯•çª—å£å¹¶å›æ”¾å…¨éƒ¨æµ‹è¯•ç”¨ä¾‹
cli auto-replay --project /Users/username/demo --replay-all
```

#### 8.2.8 å›æ”¾é…ç½®

å·¥å…·ç‰ˆæœ¬ `1.06.2211012` ä»¥ä¸Šå…è®¸é…ç½®å›æ”¾æ—¶æˆªå›¾ï¼š

- å¦‚æœé…ç½®å¤±è´¥æ—¶æˆªå›¾ï¼Œåˆ™å›¾ç‰‡å†…å®¹ä»¥ base64 å­˜æ”¾åœ¨å›æ”¾ç»“æœæ–‡ä»¶ä¸­
- å¦‚æœé…ç½®æ¯ä¸ªæ­¥éª¤éƒ½æˆªå›¾ï¼Œåˆ™å›¾ç‰‡ä¿å­˜åœ¨å’Œå›æ”¾ç»“æœæ–‡ä»¶çš„åŒåæ–‡ä»¶å¤¹ä¸­

#### 8.2.9 å°ç¨‹åºäº‘æµ‹å›æ”¾

æœ¬åœ°å›æ”¾æ—¶ï¼Œæ˜¯åŸºäºå¼€å‘è€…å·¥å…·æœ¬åœ°ä»£ç ç‰ˆæœ¬ã€‚å¦‚æœå¼€å‘è€…å¸Œæœ›åœ¨å…¶ä»–å°ç¨‹åºç‰ˆæœ¬æµ‹è¯•ï¼ˆå¦‚å›å½’æµ‹è¯•ä¸­åœ¨ä½“éªŒç‰ˆå¯¹å¤šä¸ªç”¨ä¾‹è¿›è¡Œå›æ”¾ï¼‰ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨**å°ç¨‹åºäº‘æµ‹**ã€‚

å°ç¨‹åºäº‘æµ‹æ”¯æŒå°†å½•åˆ¶å¥½çš„ç”¨ä¾‹ï¼Œåœ¨å¼€å‘ä¸­ç‰ˆæœ¬ã€ä½“éªŒç‰ˆã€çº¿ä¸Šç‰ˆè¿›è¡Œå›æ”¾ï¼Œæ”¯æŒå®šæ—¶ä»»åŠ¡/API ä»»åŠ¡ï¼Œå¹¶ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šã€‚

### 8.3 å…¶ä»–åŠŸèƒ½

#### 8.3.1 ä¼ä¸šå¾®ä¿¡å°ç¨‹åºæ”¯æŒ

å·¥å…·ç‰ˆæœ¬ `1.06.2209152` ä»¥ä¸Šæ”¯æŒä¼ä¸šå¾®ä¿¡å°ç¨‹åºè¿›è¡Œå½•åˆ¶å›æ”¾è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚åˆ‡æ¢åˆ°ä¼ä¸šå¾®ä¿¡å°ç¨‹åºæ¨¡å¼ï¼Œç„¶åä¼ä¸šå¾®ä¿¡åŸºç¡€åº“é€‰æ‹© 2.20.3ï¼Œå³å¯å’Œæ™®é€šå°ç¨‹åºä¸€æ ·ä½¿ç”¨å½•åˆ¶å›æ”¾åŠŸèƒ½ã€‚

#### 8.3.2 æµ‹è¯•è´¦å·åˆ‡æ¢

ç‚¹å‡»å¤´åƒï¼Œå¯åˆ‡æ¢æµ‹è¯•è´¦å·ã€‚

#### 8.3.3 é…ç½®æ–‡ä»¶è¯´æ˜

æµ‹è¯•ä¿å­˜ç›®å½•é»˜è®¤åœ¨ `minitest/`ï¼Œå¯åœ¨ `project.config.json` ä¿®æ”¹ï¼š

```json
"testRoot": "minitest/"
```

---

## 9. FAQ

### 9.1 æ€ä¹ˆæ“ä½œç³»ç»ŸåŸç”Ÿç»„ä»¶ï¼Œå¦‚ç”¨æˆ·æˆæƒã€ä½ç½®é€‰æ‹©ç­‰ï¼Ÿ

ç”¨æˆ·æˆæƒæ¡†ç­‰ç³»ç»Ÿç»„ä»¶ä¸æä¾›æ–¹æ³•è·å–å’Œæ“ä½œï¼Œè¯·åœ¨æ‰§è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•å‰ç¡®ä¿å·²æ‰‹å·¥å¯¹æ‰€éœ€æƒé™è¿›è¡Œæˆæƒã€‚

ä½ç½®é€‰æ‹©ç­‰è°ƒç”¨ wx å¯¹è±¡æ¥å£è§¦å‘çš„åŸç”Ÿç•Œé¢ç»„ä»¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `miniProgram.mockWxMethod` æŒ‡å®šè¿”å›ç»“æœã€‚

### 9.2 Node.js è„šæœ¬æ‰§è¡Œå®Œä¸ºä»€ä¹ˆä¸ä¼šé€€å‡ºï¼Ÿ

è¯·ç¡®ä¿åœ¨æµ‹è¯•æ‰§è¡Œå®Œæ¯•åè°ƒç”¨ `miniProgram.close` æˆ–è€… `miniProgram.disconnect` æ–­å¼€ä¸å·¥å…·çš„è¿æ¥ã€‚

### 9.3 æ€ä¹ˆåœ¨ä¸€å°æœºå™¨ä¸Šç™»å½•å¤šä¸ªè´¦å·æµ‹è¯•ï¼Ÿ

å¯ä»¥ä½¿ç”¨å·¥å…·çš„å¤šè´¦å·è°ƒè¯•åŠŸèƒ½ï¼Œé…åˆè‡ªåŠ¨åŒ–çš„ `miniProgram.testAccounts` æ¥è¾¾åˆ°ç›®çš„ã€‚

### 9.4 æ€ä¹ˆåœ¨å¤šä¸ªæœºå™¨ä¸Šçš„å·¥å…·ç™»å½•ç›¸åŒè´¦å·è¿è¡Œæµ‹è¯•ï¼Ÿ

åˆ©ç”¨ `miniProgram.getTicket` æ¥å£å¯ä»¥è·å–åˆ°å½“å‰å·¥å…·çš„ç™»å½•ç¥¨æ®ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨è¯¥ç¥¨æ®åœ¨å…¶å®ƒæœºå™¨ä¸Šç™»å½•å·¥å…·ã€‚ç¥¨æ®å…·ä½“æ€ä¹ˆä»æœºå™¨ä¸ŠåŒæ­¥åˆ°å¦ä¸€å°æœºå™¨ä¸Šï¼Œéœ€è¦å¼€å‘è€…è‡ªè¡Œç»´æŠ¤ã€‚

---

## ğŸ“š é™„å½•

### A. CLI é»˜è®¤è·¯å¾„

**Mac**

```bash
/Applications/wechatwebdevtools.app/Contents/MacOS/cli
```

**Windows**

```bash
C:/Program Files (x86)/Tencent/å¾®ä¿¡webå¼€å‘è€…å·¥å…·/cli.bat
```

### B. ç‰ˆæœ¬è¦æ±‚æ€»ç»“

| åŠŸèƒ½ | æœ€ä½ç‰ˆæœ¬è¦æ±‚ |
|------|-------------|
| åŸºæœ¬è‡ªåŠ¨åŒ– | åŸºç¡€åº“ 2.7.3 + å·¥å…· 1.02.1907232 |
| ä¼ å…¥å‡½æ•° Mock | automator 0.9.0 + åŸºç¡€åº“ 2.9.5 |
| æ’ä»¶ wx æ–¹æ³•è°ƒç”¨ | åŸºç¡€åº“ 2.19.3 |
| æˆªå›¾åŠŸèƒ½ | automator 0.9.0 + åŸºç¡€åº“ 2.9.5 + å·¥å…· 1.02.2001082 |
| å½•åˆ¶å›æ”¾ | åŸºç¡€åº“ 2.19.6 + å·¥å…· 1.05.2110202 |
| äº‘å¼€å‘ Mock | å·¥å…· 1.06.2206242 |
| ä¼ä¸šå¾®ä¿¡å°ç¨‹åº | å·¥å…· 1.06.2209152 |

### C. ç›¸å…³é“¾æ¥

- å®˜æ–¹æ–‡æ¡£ï¼š<https://developers.weixin.qq.com/miniprogram/dev/devtools/auto/>
- Jest å®˜ç½‘ï¼š<https://jestjs.io/>
- å°ç¨‹åºç¤ºä¾‹ï¼š<https://github.com/wechat-miniprogram/miniprogram-demo>

---

## ğŸ¯ å®Œæ•´æµ‹è¯•ç¤ºä¾‹

```javascript
const automator = require('miniprogram-automator')

describe('Mini Program Automation Test', () => {
  let miniProgram
  let page

  beforeAll(async () => {
    miniProgram = await automator.launch({
      projectPath: 'path/to/project'
    })
    page = await miniProgram.reLaunch('/page/index/index')
    await page.waitFor(500)
  }, 30000)

  afterAll(async () => {
    await miniProgram.close()
  })

  it('should navigate to detail page', async () => {
    const button = await page.$('.nav-button')
    await button.tap()
    await page.waitFor(500)
    expect((await miniProgram.currentPage()).path).toBe('page/detail/detail')
  })

  it('should input text correctly', async () => {
    const input = await page.$('input')
    await input.input('test text')
    expect(await input.value()).toBe('test text')
  })

  it('should handle mock request', async () => {
    await miniProgram.mockWxMethod('request', {
      data: { success: true },
      statusCode: 200
    })
    const result = await miniProgram.callWxMethod('request', {
      url: 'https://api.example.com/test'
    })
    expect(result.data.success).toBe(true)
    await miniProgram.restoreWxMethod('request')
  })
})
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-02
**æ•´ç†æ¥æº**: å¾®ä¿¡å°ç¨‹åºå®˜æ–¹æ–‡æ¡£
