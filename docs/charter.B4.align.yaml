# Charter: [B4] Logger å’Œ OutputManager

task_id: B4
task_name: Logger å’Œ OutputManager å®ç°
stage: B
phase: Align (Retrospective)
created_at: "2025-10-02"
status: COMPLETED
estimated_hours: 1-2
actual_hours: 1.5

## Goal (ç›®æ ‡)

å®ç°ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿï¼ˆLoggerï¼‰å’Œäº§ç‰©ç®¡ç†å™¨ï¼ˆOutputManagerï¼‰ï¼Œä¸º MCP Server æä¾›ç»Ÿä¸€çš„æ—¥å¿—è¾“å‡ºå’Œæ–‡ä»¶ç®¡ç†èƒ½åŠ›ã€‚

**æ ¸å¿ƒäº¤ä»˜ç‰©**:
- `src/core/logger.ts` (~50 lines)
- `src/core/output.ts` (~60 lines)
- Logger: info/warn/error æ–¹æ³•
- OutputManager: resolveOutputPath/writeFile æ–¹æ³•

## Non-Goals (éç›®æ ‡)

- âŒ ä¸å®ç°æ—¥å¿—æŒä¹…åŒ–ï¼ˆä»… console è¾“å‡ºï¼‰
- âŒ ä¸å®ç°æ—¥å¿—çº§åˆ«è¿‡æ»¤
- âŒ ä¸å®ç°æ—¥å¿—è½®è½¬
- âŒ ä¸å®ç°è¿œç¨‹æ—¥å¿—ä¸Šä¼ 

## Scope (èŒƒå›´)

### In Scope (åŒ…å«)

1. **Logger ç±»**
   - âœ… info(message: string, meta?: object): void
   - âœ… warn(message: string, meta?: object): void
   - âœ… error(message: string, meta?: object): void
   - âœ… æ‰€æœ‰æ—¥å¿—è¾“å‡ºåˆ° console.errorï¼ˆé¿å…å¹²æ‰° stdioï¼‰
   - âœ… ç»“æ„åŒ–æ—¥å¿—æ ¼å¼ï¼š[level] message {meta}

2. **OutputManager ç±»**
   - âœ… constructor(sessionId: string, baseDir: string)
   - âœ… resolveOutputPath(type: string, filename: string): string
   - âœ… writeFile(type: string, filename: string, content: string|Buffer): Promise<string>
   - âœ… ç›®å½•ç»“æ„ï¼š{baseDir}/{sessionId}/{type}/

3. **ç›®å½•ç®¡ç†**
   - âœ… è‡ªåŠ¨åˆ›å»ºç›®å½•
   - âœ… æ”¯æŒå¤šç§äº§ç‰©ç±»å‹ï¼ˆscreenshot/snapshot/log/traceï¼‰
   - âœ… è¿”å›ç»å¯¹è·¯å¾„

4. **æ–‡ä»¶æ“ä½œ**
   - âœ… å†™å…¥æ–‡æœ¬æ–‡ä»¶
   - âœ… å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆBufferï¼‰
   - âœ… é”™è¯¯å¤„ç†å’Œé‡è¯•

### Out of Scope (ä¸åŒ…å«)

- âŒ æ—¥å¿—æŒä¹…åŒ–åˆ°æ–‡ä»¶
- âŒ æ—¥å¿—çº§åˆ«é…ç½®
- âŒ æ—¥å¿—æ ¼å¼åŒ–é€‰é¡¹
- âŒ æ–‡ä»¶å‹ç¼©å’Œæ¸…ç†

## Constraints (çº¦æŸ)

### Technical Constraints (æŠ€æœ¯çº¦æŸ)

1. **stdio é¿è®©**
   - æ‰€æœ‰æ—¥å¿—å¿…é¡»è¾“å‡ºåˆ° console.error
   - ä¸èƒ½ä½¿ç”¨ console.logï¼ˆstdout è¢« MCP å ç”¨ï¼‰

2. **æ–‡ä»¶ç³»ç»Ÿ**
   - ä½¿ç”¨ Node.js fs/promises API
   - æ”¯æŒç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„
   - è‡ªåŠ¨åˆ›å»ºç›®å½•ï¼ˆrecursiveï¼‰

3. **TypeScript è§„èŒƒ**
   - å®Œæ•´ç±»å‹å®šä¹‰
   - ä¸¥æ ¼æ¨¡å¼
   - å¯¼å…¥ä½¿ç”¨ .js åç¼€

4. **é”™è¯¯å¤„ç†**
   - æ•è·æ–‡ä»¶ I/O é”™è¯¯
   - è®°å½•é”™è¯¯æ—¥å¿—
   - æŠ›å‡ºæ˜ç¡®å¼‚å¸¸

### Business Constraints (ä¸šåŠ¡çº¦æŸ)

1. **æ—¥å¿—æ€§èƒ½**: æ—¥å¿—è¾“å‡ºä¸é˜»å¡ä¸»æµç¨‹
2. **æ–‡ä»¶æ€§èƒ½**: æ–‡ä»¶å†™å…¥ <100ms
3. **å­˜å‚¨é™åˆ¶**: å•ä¼šè¯äº§ç‰© <100MB

## Success Criteria (æˆåŠŸæ ‡å‡†)

### Functional Criteria (åŠŸèƒ½æ ‡å‡†)

- âœ… Logger.info/warn/error æ­£ç¡®è¾“å‡º
- âœ… æ—¥å¿—æ ¼å¼æ¸…æ™°å¯è¯»
- âœ… OutputManager æ­£ç¡®åˆ›å»ºç›®å½•
- âœ… OutputManager æ­£ç¡®å†™å…¥æ–‡ä»¶
- âœ… resolveOutputPath è¿”å›æ­£ç¡®è·¯å¾„
- âœ… æ”¯æŒæ–‡æœ¬å’ŒäºŒè¿›åˆ¶å†…å®¹

### Quality Criteria (è´¨é‡æ ‡å‡†)

- âœ… TypeScript ç¼–è¯‘ 0 é”™è¯¯
- âœ… logger.ts ~50 è¡Œ
- âœ… output.ts ~60 è¡Œ
- âœ… æ—  ESLint é”™è¯¯
- âœ… JSDoc æ³¨é‡Šå®Œæ•´

### Documentation Criteria (æ–‡æ¡£æ ‡å‡†)

- âœ… Logger API æ–‡æ¡£
- âœ… OutputManager API æ–‡æ¡£
- âœ… ç›®å½•ç»“æ„è¯´æ˜
- â³ charter.B4.align.yaml (æœ¬æ–‡æ¡£)
- â³ tasks.B4.atomize.md (ä»»åŠ¡å¡)

## Definition of Done (å®Œæˆæ ‡å‡†)

**ä»£ç **:
- âœ… `src/core/logger.ts` å®ç°å®Œæˆ (~50 lines)
- âœ… `src/core/output.ts` å®ç°å®Œæˆ (~60 lines)
- âœ… TypeScript ç¼–è¯‘é€šè¿‡
- âœ… æ‰€æœ‰æ–¹æ³•å®ç°

**æµ‹è¯•**:
- âœ… å•å…ƒæµ‹è¯•éšå·¥å…·æµ‹è¯•éªŒè¯
- âœ… æ‰‹åŠ¨æµ‹è¯•æ—¥å¿—è¾“å‡º
- âœ… é›†æˆæµ‹è¯•æ–‡ä»¶å†™å…¥

**æ–‡æ¡£**:
- â³ charter.B4.align.yaml (è¿½æº¯)
- â³ tasks.B4.atomize.md (è¿½æº¯)
- â³ session_log (è¿½æº¯)

**Git**:
- âœ… å·²æäº¤ï¼ˆéš D2 Snapshot å·¥å…·æäº¤ï¼‰

## Dependencies (ä¾èµ–)

**å‰ç½®ä»»åŠ¡**:
- âœ… A3: ä»“åº“ç»“æ„åˆå§‹åŒ–
- âœ… Node.js fs/promises API äº†è§£

**åç»­ä»»åŠ¡**:
- B4 â†’ D2 (Snapshot å·¥å…·ä½¿ç”¨ OutputManager)
- B4 â†’ æ‰€æœ‰éœ€è¦è¾“å‡ºæ–‡ä»¶çš„å·¥å…·

## Risks (é£é™©)

### Technical Risks (æŠ€æœ¯é£é™©)

1. **stdio å¹²æ‰°** - ğŸŸ¢ å·²ç¼“è§£
   - å½±å“ï¼šconsole.log å¹²æ‰° MCP åè®®
   - ç¼“è§£ï¼šå¼ºåˆ¶ä½¿ç”¨ console.error

2. **æ–‡ä»¶æƒé™** - ğŸŸ¡ ä¸­é£é™©
   - å½±å“ï¼šæ— æ³•åˆ›å»ºç›®å½•/å†™å…¥æ–‡ä»¶
   - ç¼“è§£ï¼šé”™è¯¯å¤„ç† + æ¸…æ™°é”™è¯¯æ¶ˆæ¯

3. **è·¯å¾„å®‰å…¨** - ğŸŸ¡ ä¸­é£é™©
   - å½±å“ï¼šè·¯å¾„éå†æ”»å‡»
   - ç¼“è§£ï¼šè·¯å¾„éªŒè¯å’Œè§„èŒƒåŒ–

### Business Risks (ä¸šåŠ¡é£é™©)

1. **å­˜å‚¨å ç”¨** - ğŸŸ¢ ä½é£é™©
   - å½±å“ï¼šäº§ç‰©æ–‡ä»¶å ç”¨ç£ç›˜ç©ºé—´
   - ç¼“è§£ï¼šä¼šè¯æ¸…ç†æœºåˆ¶ + ç”¨æˆ·ç®¡ç†

## Open Questions (æœªå†³é—®é¢˜)

- âœ… æ—¥å¿—æ˜¯å¦éœ€è¦æŒä¹…åŒ–ï¼Ÿï¼ˆå¦ï¼Œä»… console è¾“å‡ºï¼‰
- âœ… æ˜¯å¦éœ€è¦æ—¥å¿—çº§åˆ«è¿‡æ»¤ï¼Ÿï¼ˆå¦ï¼Œåç»­æ‰©å±•ï¼‰
- â“ æ˜¯å¦éœ€è¦äº§ç‰©æ–‡ä»¶æ¸…ç†ç­–ç•¥ï¼Ÿï¼ˆå½“å‰æ‰‹åŠ¨æ¸…ç†ï¼‰

## References (å‚è€ƒèµ„æ–™)

- `docs/å®Œæ•´å®ç°æ–¹æ¡ˆ.md` - æ—¥å¿—å’Œäº§ç‰©ç®¡ç†è®¾è®¡
- Node.js fs/promises API æ–‡æ¡£
- Node.js path API æ–‡æ¡£

---

**Approval**: âœ… RETROSPECTIVE APPROVED
**Implementation**: âœ… COMPLETED
**Documentation**: â³ IN PROGRESS
