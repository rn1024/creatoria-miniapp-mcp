# Charter: F3 - ä¼šè¯æŠ¥å‘Šç”Ÿæˆ

## é¡¹ç›®ä¿¡æ¯
project: creatoria-miniapp-mcp
stage: F - å¯è§‚æµ‹æ€§ä¸äº§ç‰©è¾“å‡º
task_id: F3
title: ä¼šè¯æŠ¥å‘Šç”Ÿæˆï¼ˆJSON/Markdown æ±‡æ€»ï¼‰
owner: ClaudeCode
created: 2025-10-03
status: in_progress

## 1. ç›®æ ‡ (Goals)
### ä¸»è¦ç›®æ ‡
- **ä¼šè¯æ±‡æ€»**ï¼šè‡ªåŠ¨ç”Ÿæˆä¼šè¯æ‰§è¡ŒæŠ¥å‘Šï¼ŒåŒ…å«æ‰€æœ‰å·¥å…·è°ƒç”¨ã€æ‰§è¡Œæ—¶é•¿ã€æˆåŠŸ/å¤±è´¥ç»Ÿè®¡
- **åŒæ ¼å¼è¾“å‡º**ï¼šæ”¯æŒ JSONï¼ˆæœºå™¨å¯è¯»ï¼‰å’Œ Markdownï¼ˆäººç±»å¯è¯»ï¼‰ä¸¤ç§æ ¼å¼
- **å¤±è´¥è¿½è¸ª**ï¼šæ±‡æ€»æ‰€æœ‰å¤±è´¥çš„å·¥å…·è°ƒç”¨ï¼Œå…³è” F2 å¿«ç…§ç›®å½•
- **æ€§èƒ½åˆ†æ**ï¼šæä¾›å·¥å…·è°ƒç”¨è€—æ—¶ç»Ÿè®¡ï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆ

### ä¸šåŠ¡ä»·å€¼
- **è°ƒè¯•åŠ é€Ÿ**ï¼šä¸€ç«™å¼æŸ¥çœ‹ä¼šè¯å…¨è²Œï¼Œå¿«é€Ÿå®šä½é—®é¢˜
- **è´¨é‡åº¦é‡**ï¼šæä¾›æˆåŠŸç‡ã€å¹³å‡è€—æ—¶ç­‰æŒ‡æ ‡ï¼Œè¯„ä¼°è‡ªåŠ¨åŒ–è„šæœ¬è´¨é‡
- **æŠ¥å‘Šåˆ†äº«**ï¼šMarkdown æ ¼å¼ä¾¿äºåœ¨å›¢é˜Ÿä¸­å…±äº«æµ‹è¯•ç»“æœ

## 2. éç›®æ ‡ (Non-Goals)
- âŒ ä¸å®ç°å®æ—¶æŠ¥å‘Šæ›´æ–°ï¼ˆä»…ä¼šè¯ç»“æŸæ—¶ç”Ÿæˆï¼‰
- âŒ ä¸å®ç°æŠ¥å‘Šçš„è‡ªåŠ¨ä¸Šä¼ /åˆ†å‘ï¼ˆç”¨æˆ·è‡ªè¡Œå¤„ç†ï¼‰
- âŒ ä¸å®ç°å¯è§†åŒ–å›¾è¡¨ï¼ˆçº¯æ–‡æœ¬/JSONï¼‰
- âŒ ä¸å®ç°å¤šä¼šè¯å¯¹æ¯”åˆ†æï¼ˆå•ä¼šè¯ç»´åº¦ï¼‰

## 3. èŒƒå›´ (Scope)
### In Scope
- âœ… ä¼šè¯çº§åˆ«æ•°æ®æ”¶é›†
  - å·¥å…·è°ƒç”¨è®°å½•ï¼ˆå·¥å…·åã€å‚æ•°ã€ç»“æœã€è€—æ—¶ã€çŠ¶æ€ï¼‰
  - å¤±è´¥è¯¦æƒ…ï¼ˆé”™è¯¯æ¶ˆæ¯ã€å¿«ç…§è·¯å¾„ï¼‰
  - ä¼šè¯å…ƒæ•°æ®ï¼ˆåˆ›å»ºæ—¶é—´ã€ç»“æŸæ—¶é—´ã€æ€»è€—æ—¶ï¼‰
- âœ… JSON æŠ¥å‘Šç”Ÿæˆ
  - ç»“æ„åŒ–æ•°æ®ï¼ˆå¯ç¼–ç¨‹è§£æï¼‰
  - å®Œæ•´çš„è°ƒç”¨å†å²
  - ç»Ÿè®¡æŒ‡æ ‡
- âœ… Markdown æŠ¥å‘Šç”Ÿæˆ
  - æ±‡æ€»è¡¨æ ¼
  - å¤±è´¥è¯¦æƒ…åˆ—è¡¨
  - æ€§èƒ½ç»Ÿè®¡
- âœ… æŠ¥å‘Šå­˜å‚¨
  - è·¯å¾„ï¼š`artifacts/{sessionId}/report.json`
  - è·¯å¾„ï¼š`artifacts/{sessionId}/report.md`

### Out of Scope
- ğŸš« HTML/PDF æ ¼å¼ï¼ˆè¶…å‡ºèŒƒå›´ï¼‰
- ğŸš« å®æ—¶æµå¼æŠ¥å‘Šï¼ˆä»…æœ€ç»ˆæŠ¥å‘Šï¼‰
- ğŸš« å¤šä¼šè¯èšåˆï¼ˆå•ä¼šè¯ç‹¬ç«‹ï¼‰
- ğŸš« å‘Šè­¦/é€šçŸ¥æœºåˆ¶ï¼ˆè¶…å‡ºæœ¬åœ° MCP èŒè´£ï¼‰

## 4. çº¦æŸ (Constraints)
### æŠ€æœ¯çº¦æŸ
- **ä¾èµ– F1**ï¼šéœ€è¦ä»ç»“æ„åŒ–æ—¥å¿—ä¸­æå–å·¥å…·è°ƒç”¨æ•°æ®
- **ä¾èµ– F2**ï¼šéœ€è¦å…³è”å¤±è´¥å¿«ç…§è·¯å¾„
- **å†…å­˜é™åˆ¶**ï¼šéœ€è¦åœ¨ä¼šè¯æœŸé—´ç¼“å­˜æ‰€æœ‰è°ƒç”¨è®°å½•ï¼ˆæ§åˆ¶å†…å­˜å¢é•¿ï¼‰
- **æ–‡ä»¶æ ¼å¼**ï¼šJSON å¿…é¡»ç¬¦åˆ JSON Schemaï¼ŒMarkdown å¿…é¡»ç¬¦åˆ CommonMark

### è®¾è®¡çº¦æŸ
- **å¯é€‰åŠŸèƒ½**ï¼šé»˜è®¤ç¦ç”¨ï¼Œæ˜¾å¼å¯ç”¨ï¼ˆé¿å…äº§ç”Ÿè¿‡å¤šæ–‡ä»¶ï¼‰
- **å¼‚æ­¥ç”Ÿæˆ**ï¼šæŠ¥å‘Šç”Ÿæˆä¸åº”é˜»å¡ä¼šè¯å…³é—­
- **å®¹é”™æ€§**ï¼šæŠ¥å‘Šç”Ÿæˆå¤±è´¥ä¸åº”å½±å“ä¼šè¯æ­£å¸¸å…³é—­

## 5. è§£å†³æ–¹æ¡ˆ (Solution)
### 5.1 æ•°æ®æ”¶é›†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SessionState                             â”‚
â”‚                                                              â”‚
â”‚  reportData?: {                                              â”‚
â”‚    toolCalls: ToolCallRecord[]                               â”‚
â”‚    startTime: Date                                           â”‚
â”‚    endTime?: Date                                            â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ToolCallRecord ç»“æ„**:
```typescript
interface ToolCallRecord {
  timestamp: Date
  toolName: string
  args: any // Sanitized
  duration: number // milliseconds
  success: boolean
  result?: any // Sanitized
  error?: {
    message: string
    snapshotPath?: string // Link to F2 snapshot
  }
}
```

### 5.2 æŠ¥å‘Šç”Ÿæˆæµç¨‹
```yaml
æ­¥éª¤:
  1. ä¼šè¯å¼€å§‹:
     - åˆå§‹åŒ– reportData = { toolCalls: [], startTime: now }

  2. å·¥å…·è°ƒç”¨æ—¶ (ToolLogger):
     - è®°å½• ToolCallRecord åˆ° session.reportData.toolCalls

  3. ä¼šè¯å…³é—­:
     - è®¾ç½® reportData.endTime = now
     - è°ƒç”¨ generateReport(session)
     - ç”Ÿæˆ report.json å’Œ report.md
     - ä¿å­˜åˆ° artifacts/{sessionId}/
```

### 5.3 æŠ¥å‘Šæ ¼å¼

#### JSON æ ¼å¼
```json
{
  "sessionId": "test-session-123",
  "startTime": "2025-10-03T06:00:00.000Z",
  "endTime": "2025-10-03T06:15:30.000Z",
  "duration": 930000,
  "summary": {
    "totalCalls": 50,
    "successCount": 47,
    "failureCount": 3,
    "successRate": 0.94,
    "avgDuration": 1500,
    "maxDuration": 5000,
    "minDuration": 100
  },
  "toolCalls": [
    {
      "timestamp": "2025-10-03T06:00:05.000Z",
      "toolName": "miniprogram_launch",
      "duration": 3000,
      "success": true
    },
    {
      "timestamp": "2025-10-03T06:05:10.000Z",
      "toolName": "element_click",
      "duration": 500,
      "success": false,
      "error": {
        "message": "Element not found",
        "snapshotPath": "failures/element_click-2025-10-03_06-05-10-123Z"
      }
    }
  ],
  "failures": [
    {
      "toolName": "element_click",
      "timestamp": "2025-10-03T06:05:10.000Z",
      "error": "Element not found",
      "snapshotPath": "failures/element_click-2025-10-03_06-05-10-123Z"
    }
  ]
}
```

#### Markdown æ ¼å¼
```markdown
# Session Report: test-session-123

## Summary
- **Duration**: 15m 30s
- **Total Calls**: 50
- **Success Rate**: 94% (47/50)
- **Average Duration**: 1.5s

## Tool Call Statistics
| Tool Name | Calls | Success | Failure | Avg Duration |
|-----------|-------|---------|---------|--------------|
| miniprogram_launch | 1 | 1 | 0 | 3.0s |
| page_navigate | 5 | 5 | 0 | 0.8s |
| element_click | 10 | 8 | 2 | 0.5s |
| element_input | 8 | 8 | 0 | 0.3s |

## Failures
### 1. element_click
- **Time**: 2025-10-03 06:05:10
- **Error**: Element not found
- **Snapshot**: [failures/element_click-2025-10-03_06-05-10-123Z](failures/element_click-2025-10-03_06-05-10-123Z)

## Timeline
| Time | Tool | Status | Duration |
|------|------|--------|----------|
| 06:00:05 | miniprogram_launch | âœ… | 3.0s |
| 06:00:08 | page_navigate | âœ… | 0.8s |
| 06:05:10 | element_click | âŒ | 0.5s |
```

## 6. å®ç°è®¡åˆ’ (Implementation Plan)
### Phase 1: æ•°æ®æ”¶é›† (1h)
- [ ] æ‰©å±• SessionState ç±»å‹å®šä¹‰
- [ ] åœ¨ ToolLogger.wrap() ä¸­è®°å½• ToolCallRecord
- [ ] æ·»åŠ é…ç½®é¡¹ `enableSessionReport`

### Phase 2: æŠ¥å‘Šç”Ÿæˆ (2h)
- [ ] å®ç° ReportGenerator ç±»
- [ ] å®ç° generateJSONReport()
- [ ] å®ç° generateMarkdownReport()
- [ ] é›†æˆåˆ° session.dispose()

### Phase 3: æµ‹è¯•éªŒè¯ (1h)
- [ ] å•å…ƒæµ‹è¯•ï¼šæ•°æ®æ”¶é›†
- [ ] å•å…ƒæµ‹è¯•ï¼šJSON æ ¼å¼éªŒè¯
- [ ] å•å…ƒæµ‹è¯•ï¼šMarkdown æ ¼å¼éªŒè¯
- [ ] é›†æˆæµ‹è¯•ï¼šç«¯åˆ°ç«¯æŠ¥å‘Šç”Ÿæˆ

## 7. éªŒæ”¶æ ‡å‡† (Definition of Done)
### åŠŸèƒ½éªŒæ”¶
- âœ… ä¼šè¯ç»“æŸæ—¶è‡ªåŠ¨ç”Ÿæˆ report.json å’Œ report.md
- âœ… JSON æ ¼å¼åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µï¼ˆsummaryã€toolCallsã€failuresï¼‰
- âœ… Markdown æ ¼å¼å¯è¯»æ€§å¼ºï¼ŒåŒ…å«è¡¨æ ¼å’Œé“¾æ¥
- âœ… å¤±è´¥è®°å½•æ­£ç¡®å…³è” F2 å¿«ç…§è·¯å¾„
- âœ… é…ç½®ä¸º `false` æ—¶ä¸ç”ŸæˆæŠ¥å‘Š

### è´¨é‡éªŒæ”¶
- âœ… æ–°å¢æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… ç°æœ‰æµ‹è¯•ç”¨ä¾‹æ— å›å½’ï¼ˆ406+ å…¨é€šè¿‡ï¼‰
- âœ… TypeScript ç¼–è¯‘æ— é”™è¯¯
- âœ… ä»£ç æ ¼å¼åŒ–å®Œæˆï¼ˆPrettierï¼‰

### æ–‡æ¡£éªŒæ”¶
- âœ… charter.F3.align.yaml å®Œæˆ
- âœ… architecture.F3.md å®Œæˆ
- âœ… ä½¿ç”¨ç¤ºä¾‹æ›´æ–°

## 8. é£é™©ä¸ç¼“è§£ (Risks)
### é£é™© #1: å†…å­˜å ç”¨éšä¼šè¯å¢é•¿
- **å½±å“**: é•¿æ—¶é—´ä¼šè¯å¯èƒ½äº§ç”Ÿå¤§é‡ ToolCallRecord
- **ç¼“è§£**:
  - é™åˆ¶å•ä¸ªä¼šè¯æœ€å¤§è°ƒç”¨è®°å½•æ•°ï¼ˆå¦‚ 1000 æ¡ï¼‰
  - è¶…å‡ºé™åˆ¶åï¼Œä¸¢å¼ƒæœ€æ—©çš„è®°å½•
  - æ–‡æ¡£å»ºè®®å®šæœŸåˆ›å»ºæ–°ä¼šè¯
- **ç›‘æ§**: è®°å½• toolCalls æ•°ç»„é•¿åº¦åˆ°æ—¥å¿—

### é£é™© #2: æŠ¥å‘Šç”Ÿæˆè€—æ—¶å½±å“å…³é—­é€Ÿåº¦
- **å½±å“**: ç”¨æˆ·ç­‰å¾…ä¼šè¯å…³é—­æ—¶é—´å˜é•¿
- **ç¼“è§£**:
  - Fire-and-forget æ¨¡å¼ç”ŸæˆæŠ¥å‘Š
  - æŠ¥å‘Šç”Ÿæˆå¤±è´¥ä¸é˜»å¡å…³é—­
- **ç›‘æ§**: è®°å½•æŠ¥å‘Šç”Ÿæˆè€—æ—¶

### é£é™© #3: æ•æ„Ÿæ•°æ®æ³„æ¼åˆ°æŠ¥å‘Š
- **å½±å“**: æŠ¥å‘Šæ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯
- **ç¼“è§£**:
  - å¤ç”¨ F1 è„±æ•é€»è¾‘å¤„ç† args/result
  - æ–‡æ¡£æé†’æŠ¥å‘Šæ–‡ä»¶çš„éšç§é£é™©
- **ç›‘æ§**: Code review æ£€æŸ¥è„±æ•é€»è¾‘

## 9. ä¾èµ–å…³ç³» (Dependencies)
### è¾“å…¥ä¾èµ–
- âœ… **F1 (æ—¥å¿—ç³»ç»Ÿ)**ï¼šToolLogger å·²å®ç°
- âœ… **F2 (å¤±è´¥å¿«ç…§)**ï¼šå¿«ç…§è·¯å¾„æ ¼å¼å·²ç¡®å®š
- âœ… **OutputManager**ï¼šæ–‡ä»¶å†™å…¥èƒ½åŠ›å·²å®ç°

### è¾“å‡ºä¾èµ–
- æ— ä¸‹æ¸¸ä¾èµ–ï¼ˆF3 æ˜¯ Stage F çš„æœ€åä»»åŠ¡ï¼‰

## 10. é‡Œç¨‹ç¢‘ (Milestones)
| é‡Œç¨‹ç¢‘ | ç›®æ ‡ | é¢„è®¡å®Œæˆ |
|--------|------|----------|
| M1 | æ•°æ®æ”¶é›†å®Œæˆ | T+1h |
| M2 | æŠ¥å‘Šç”Ÿæˆå®Œæˆ | T+3h |
| M3 | æµ‹è¯•éªŒè¯é€šè¿‡ | T+4h |
| M4 | Code Review + æäº¤ | T+4.5h |

## 11. æˆåŠŸæŒ‡æ ‡ (Success Metrics)
- **åŠŸèƒ½å®Œæ•´æ€§**: æŠ¥å‘Šç”ŸæˆæˆåŠŸç‡ 100%ï¼ˆé…ç½®å¯ç”¨æ—¶ï¼‰
- **æ€§èƒ½å½±å“**: æŠ¥å‘Šç”Ÿæˆè€—æ—¶ < 200msï¼ˆä¸é˜»å¡å…³é—­ï¼‰
- **æ–‡ä»¶å¤§å°**: å•ä¼šè¯æŠ¥å‘Š < 1MBï¼ˆæ§åˆ¶ç£ç›˜å ç”¨ï¼‰
- **å¯è¯»æ€§**: Markdown æ ¼å¼åœ¨ GitHub é¢„è§ˆæ­£å¸¸

## 12. å¼€æ”¾é—®é¢˜ (Open Questions)
- â“ Q1: æ˜¯å¦éœ€è¦æ”¯æŒæŠ¥å‘Šæ¨¡æ¿è‡ªå®šä¹‰ï¼Ÿ
  - å»ºè®®ï¼šF3 ä¿æŒç®€å•ï¼Œå›ºå®šæ ¼å¼ï¼›è‡ªå®šä¹‰ç•™ç»™ç”¨æˆ·åå¤„ç†

- â“ Q2: æ˜¯å¦éœ€è¦æ”¯æŒå¢é‡æŠ¥å‘Šï¼ˆä¼šè¯è¿‡ç¨‹ä¸­å®æ—¶æ›´æ–°ï¼‰ï¼Ÿ
  - å»ºè®®ï¼šF3 ä»…æ”¯æŒæœ€ç»ˆæŠ¥å‘Šï¼›å®æ—¶åŠŸèƒ½å¤æ‚åº¦é«˜ï¼Œç•™ç»™æœªæ¥ä¼˜åŒ–

- â“ Q3: æ˜¯å¦éœ€è¦åŒ…å«é¡µé¢æˆªå›¾é“¾æ¥ï¼Ÿ
  - å»ºè®®ï¼šä»…é“¾æ¥ F2 å¤±è´¥å¿«ç…§ï¼›æˆåŠŸè°ƒç”¨çš„æˆªå›¾ä¸åŒ…å«ï¼ˆé¿å…æŠ¥å‘Šè¿‡å¤§ï¼‰

## 13. å®¡æ‰¹è®°å½• (Approvals)
- [ ] **æŠ€æœ¯æ–¹æ¡ˆå®¡æ‰¹**: å¾…å®¡æ‰¹
- [ ] **å®‰å…¨å®¡æŸ¥**: å¾…å®¡æ‰¹
- [ ] **å®ç°æ‰¹å‡†**: å¾…æ‰¹å‡†
