# Charter: [B1] MCP Server éª¨æ¶

task_id: B1
task_name: MCP Server éª¨æ¶å®ç°
stage: B
phase: Align (Retrospective)
created_at: "2025-10-02"
status: COMPLETED
estimated_hours: 2-3
actual_hours: 2

## Goal (ç›®æ ‡)

å®ç°å¯è¿è¡Œçš„ MCP Server éª¨æ¶ï¼Œæ”¯æŒ stdio transport è¿æ¥ï¼Œèƒ½å¤Ÿå¯åŠ¨å¹¶å“åº”åŸºæœ¬çš„ MCP åè®®è¯·æ±‚ã€‚

**æ ¸å¿ƒäº¤ä»˜ç‰©**:
- `src/server.ts` - MCP Server å…¥å£æ–‡ä»¶
- `startServer(config)` å‡½æ•°
- ListToolsRequestSchema å¤„ç†å™¨
- ä¼˜é›…å…³é—­æœºåˆ¶

## Non-Goals (éç›®æ ‡)

- âŒ ä¸å®ç°å…·ä½“å·¥å…·ï¼ˆç•™ç»™ C1-C5ï¼‰
- âŒ ä¸å®ç°é…ç½®æ–‡ä»¶è§£æï¼ˆç•™ç»™ E2ï¼‰
- âŒ ä¸å®ç° CLI å…¥å£ï¼ˆç•™ç»™ E3ï¼‰
- âŒ ä¸å®ç° SessionStore å†…éƒ¨é€»è¾‘ï¼ˆå±äº B2ï¼‰

## Scope (èŒƒå›´)

### In Scope (åŒ…å«)

1. **Server å®ä¾‹åŒ–**
   - âœ… ä½¿ç”¨ `@modelcontextprotocol/sdk` çš„ Server ç±»
   - âœ… è®¾ç½® name å’Œ version
   - âœ… é…ç½® capabilities: `{ tools: {} }`

2. **Transport é…ç½®**
   - âœ… ä½¿ç”¨ `StdioServerTransport`
   - âœ… è°ƒç”¨ `server.connect(transport)`
   - âœ… è¾“å‡ºå¯åŠ¨æ—¥å¿—åˆ° stderr

3. **å·¥å…·æ³¨å†Œé›†æˆ**
   - âœ… è°ƒç”¨ `registerTools(server, context)`
   - âœ… ä¼ é€’ SessionStore çš„ getSession/deleteSession å›è°ƒ
   - âœ… æ”¯æŒ capabilities å‚æ•°

4. **ListToolsRequestSchema å¤„ç†**
   - âœ… è¿”å› registerTools æ³¨å†Œçš„å·¥å…·åˆ—è¡¨
   - âœ… ç¬¦åˆ MCP åè®®è§„èŒƒ

5. **ä¼˜é›…å…³é—­**
   - âœ… ç›‘å¬ SIGINT å’Œ SIGTERM
   - âœ… è°ƒç”¨ sessionStore.dispose()
   - âœ… è¾“å‡ºå…³é—­æ—¥å¿—

### Out of Scope (ä¸åŒ…å«)

- âŒ SessionStore å†…éƒ¨å®ç°
- âŒ å…·ä½“å·¥å…· handler é€»è¾‘
- âŒ é…ç½®æ–‡ä»¶è§£æ
- âŒ CLI å‚æ•°å¤„ç†
- âŒ é”™è¯¯ç›‘æ§å’Œé‡è¯•

## Constraints (çº¦æŸ)

### Technical Constraints (æŠ€æœ¯çº¦æŸ)

1. **MCP åè®®å…¼å®¹**
   - å¿…é¡»ä½¿ç”¨å®˜æ–¹ SDK (`@modelcontextprotocol/sdk`)
   - éµå¾ª stdio transport è§„èŒƒ
   - æ­£ç¡®å¤„ç† JSON-RPC æ¶ˆæ¯

2. **TypeScript è§„èŒƒ**
   - ESNext + ESM æ¨¡å¼
   - å¯¼å…¥ä½¿ç”¨ `.js` åç¼€
   - ä¸¥æ ¼ç±»å‹æ£€æŸ¥

3. **æ—¥å¿—è¾“å‡º**
   - ä½¿ç”¨ `console.error` é¿å…å¹²æ‰° stdio
   - ä¸è¾“å‡ºåˆ° stdoutï¼ˆè¢« MCP åè®®å ç”¨ï¼‰

4. **ä¾èµ–æ³¨å…¥**
   - SessionStore ä½œä¸ºå¤–éƒ¨ä¾èµ–
   - registerTools é€šè¿‡å‚æ•°ä¼ å…¥

### Business Constraints (ä¸šåŠ¡çº¦æŸ)

1. **å¯åŠ¨æ—¶é—´**: <1 ç§’
2. **å†…å­˜å ç”¨**: å¯åŠ¨æ—¶ <50MB
3. **å…¼å®¹æ€§**: æ”¯æŒ Node.js 18+

## Success Criteria (æˆåŠŸæ ‡å‡†)

### Functional Criteria (åŠŸèƒ½æ ‡å‡†)

- âœ… è¿è¡Œ `node dist/server.js` æˆåŠŸå¯åŠ¨
- âœ… MCP å®¢æˆ·ç«¯å¯è¿æ¥
- âœ… `list_tools` è¯·æ±‚è¿”å›å·¥å…·åˆ—è¡¨
- âœ… CTRL+C è§¦å‘ä¼˜é›…å…³é—­
- âœ… sessionStore.dispose() è¢«è°ƒç”¨

### Quality Criteria (è´¨é‡æ ‡å‡†)

- âœ… TypeScript ç¼–è¯‘ 0 é”™è¯¯
- âœ… ä»£ç è¡Œæ•° <100 è¡Œï¼ˆå®é™… 64 è¡Œï¼‰
- âœ… æ—  ESLint é”™è¯¯
- âœ… JSDoc æ³¨é‡Šå®Œæ•´

### Documentation Criteria (æ–‡æ¡£æ ‡å‡†)

- âœ… å‡½æ•°ç­¾åæœ‰ JSDoc
- âœ… README æ›´æ–°å¯åŠ¨è¯´æ˜
- â³ charter.B1.align.yaml (æœ¬æ–‡æ¡£)
- â³ tasks.B1.atomize.md (ä»»åŠ¡å¡)

## Definition of Done (å®Œæˆæ ‡å‡†)

**ä»£ç **:
- âœ… `src/server.ts` å®ç°å®Œæˆ (64 lines)
- âœ… TypeScript ç¼–è¯‘é€šè¿‡
- âœ… é›†æˆ SessionStore å’Œ registerTools

**æµ‹è¯•**:
- âœ… æ‰‹åŠ¨æµ‹è¯•ï¼šå¯åŠ¨ Server å¹¶è¿æ¥
- âœ… é›†æˆæµ‹è¯•ï¼šé€šè¿‡å…¶ä»–å·¥å…·æµ‹è¯•é—´æ¥éªŒè¯

**æ–‡æ¡£**:
- â³ charter.B1.align.yaml (è¿½æº¯)
- â³ tasks.B1.atomize.md (è¿½æº¯)
- â³ session_log (è¿½æº¯)

**Git**:
- âœ… å·²æäº¤ï¼ˆéš A2-B1-B2 ä¿®å¤æäº¤ï¼‰

## Dependencies (ä¾èµ–)

**å‰ç½®ä»»åŠ¡**:
- âœ… A3: ä»“åº“ç»“æ„åˆå§‹åŒ–
- âœ… `@modelcontextprotocol/sdk` å·²å®‰è£…

**åç»­ä»»åŠ¡**:
- B1 â†’ B2 (Server éœ€è¦ SessionStore)
- B1 â†’ C5 (registerTools å‡½æ•°)

## Risks (é£é™©)

### Technical Risks (æŠ€æœ¯é£é™©)

1. **MCP SDK å‡çº§** - ğŸŸ¢ ä½é£é™©
   - å½±å“ï¼šAPI å˜æ›´å¯èƒ½ç ´åå…¼å®¹
   - ç¼“è§£ï¼šé”å®š SDK ç‰ˆæœ¬

2. **stdio å¹²æ‰°** - ğŸŸ¢ å·²ç¼“è§£
   - é£é™©ï¼šæ—¥å¿—è¾“å‡ºåˆ° stdout å¹²æ‰°åè®®
   - ç¼“è§£ï¼šæ‰€æœ‰æ—¥å¿—ä½¿ç”¨ console.error

### Business Risks (ä¸šåŠ¡é£é™©)

1. **å¯åŠ¨å¤±è´¥** - ğŸŸ¢ å·²ç¼“è§£
   - å½±å“ï¼šServer æ— æ³•å¯åŠ¨å¯¼è‡´æœåŠ¡ä¸å¯ç”¨
   - ç¼“è§£ï¼šé”™è¯¯æ—¥å¿—æ¸…æ™°ï¼Œä¾¿äºæ’æŸ¥

## Open Questions (æœªå†³é—®é¢˜)

- â“ æ˜¯å¦éœ€è¦æ”¯æŒå¤šä¸ª transportï¼ˆHTTP/WebSocketï¼‰ï¼Ÿï¼ˆå½“å‰ä»… stdioï¼‰
- â“ æ˜¯å¦éœ€è¦å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼Ÿï¼ˆå½“å‰æ— ï¼‰

## References (å‚è€ƒèµ„æ–™)

- `docs/å®Œæ•´å®ç°æ–¹æ¡ˆ.md` - Server æ¶æ„è®¾è®¡
- `docs/ç¬¬ä¸€ç‰ˆæœ¬æ–¹æ¡ˆ.md` - MCP é›†æˆæ–¹æ¡ˆ
- `@modelcontextprotocol/sdk` æ–‡æ¡£

---

**Approval**: âœ… RETROSPECTIVE APPROVED
**Implementation**: âœ… COMPLETED
**Documentation**: â³ IN PROGRESS
